{"version":3,"sources":["contexts/MainContext.js","utils/hocs.js","assets/imgs/tab-start.svg","utils/components/Alert/Alert.js","utils/hooks.js","utils/components/Spinner/Spinner.js","components/CommentThread/CommentThread.js","utils/components/AnimatedRoute.js","components/PageBook/PageBook.js","utils/components/SegmentControls/SegmentControls.js","utils/helper.js","components/MyComponent.js","reducers/mainReducer.js","components/PdfRenderer/PdfRenderer.js","components/Comment/Comment.js","components/Header/Header.js","assets/imgs/default-profile-icon.jpg","components/Sidemenu/Sidemenu.js","components/BookThumbnail/BookThumbnail.js","components/Group/Group.js","components/PageDashboard/PageDashboard.js","components/PageLogin/PageLogin.js","utils/components/TabsRow/TabsRow.js","components/PageGroups/PageGroups.js","components/PageRegister/PageRegister.js","components/ModalEditGroup/ModalEditGroup.js","components/App/App.js","components/PageGroup/PageGroup.js","components/ModalEditBook/ModalEditBook.js","assets/imgs/banner.png","components/PdfPublicRightSidebar/PdfPublicRightSidebar.js","assets/imgs/spinner.gif","components/PdfVerticalScroll/PdfVerticalScroll.js","components/PdfNotesRightSidebar/PdfNotesRightSidebar.js","components/PdfHighlightRightSidebar/PdfHighlightRightSidebar.js","serviceWorker.js","index.js"],"names":["window","axios","dispatch","history","MainContext","createContext","JSON","parse","initState","nonAlphaNumericRegex","passwordRegex","token","setToken","newToken","undefined","forceUpdateApp","MainContextProvider","state","children","useHistory","useReducer","mainReducer","useEffect","location","pathname","indexOf","reLogin","Provider","value","api","method","url","data","a","o","headers","Authorization","withCredentials","res","onError","e","console","log","response","setAlert","className","style","width","message","onClick","apiWithRetry","loop","status","StatusCodes","UNAUTHORIZED","showRetry","err","Promise","resolve","logout","withParamsMemoized","Component","props","params","useMemoObject","animatedProps","_match","useParams","withContext","Context","dependencies","_","pick","useContext","module","exports","withRouter","alert","useState","id","minWidth","maxWidth","maxHeight","useLocal","initialState","useForceUpdate","setState","usePreEffect","deps","effect","oldDeps","prevDeps","changed","didChange","i","useLifecycle","componentWillMount","componentDidMount","componentWillUnmount","type","Error","obj","oldObj","newObj","Spinner","ref","useRef","src","require","alt","stringify","body","hashtags","onSubmit","preventDefault","commentId","match","context","COMMENTS","userId","comment","replace","trim","user_id","book_id","reply_to_id","comment_type","then","this","USERS","goBack","cursor","disableTracksWidthCompensation","height","Comment","showChildren","username","required","cols","rows","placeholder","twoWayBind","MyComponent","contextType","stateEnum","Entering","Entered","Exiting","Exited","AnimatedRoute","component","render","timeout","forceUpdate","local","stateNumeric","timeStamp","componentDidEnter","componentWillExit","enter","exit","setLocalState","Date","now","setTimeout","setEntered","setExited","C","BookContext","PdfVerticalScroll","default","rightSidebars","publicPrivateModes","categorizedInitState","NewCommentBubble","memo","BOOKS","GROUPS","SELECTIONS","visiblePagesStylesRef","book","bookId","group","group_id","topMostVisiblePage","bottomMostVisiblePage","visiblePagesStyles","pageWiseCommentsBefore","pageWiseCommentsAfter","pdf","setBubblePos","categorized","pageWiseComments","destroy","sidebarMode","setSidebarMode","selection","setSelection","setPdf","publicPrivateMode","refresh","loadPdf","comment_ids","allComments","forEach","c","hidden","push","s","p","pageNum","page","RightSidebar","BookContextLocal","setVisiblePages","topPage","bottomPage","styles","join","current","setProperty","innerHTML","setCssFromIState","Header","SegmentControls","title","path","CommentThread","NewPublicComment","file","pdfLoadTask","pdfjs","getDocument","onProgress","loaded","total","promise","promises","Array","numPages","length","getPage","all","pages","viewports","generateViewports","scale","map","getViewport","myComments","setMyComments","pageWiseCommentsTotal","filtered","mapValues","filter","isValidResult","temp","prevI","tabStart","temp2","j","PageWiseComments","key","bubblePos","to","selection_data","clientHeight","document","querySelector","scrollIntoView","behavior","Page","setLoaded","loaders","viewport","pageComments","data-page-index","styleRef","showSpinner","active","classList","add","remove","text","name","setSpinner","target","spinnerEle","vertical","val","Number","isInteger","sizeAttr","transform","getChildNodeIndex","element","from","parentNode","getSelectionOffsetFromParent","node","parent","offset","warn","previousSibling","innerText","binarySearchFindClosestIndex","sortedArray","ele","getClosestIndex","i1","i2","n","low","high","mid","fileToBase64","reject","reader","FileReader","readAsDataURL","onload","result","onerror","error","property","event","valAttr","otherState","setOtherState","newOtherState","forIn","PureComponent","modes","dev","mode","stage","prod","UI_DARKMODE","version","oldState","rest","actionType","mainReducerInner","genLibrary","users","groups","books","comments","parseSelections","lib","d","workerSrc","PdfImage","setSrc","canvas","createElement","canvasContext","getContext","toDataURL","renderTextLayer","getTextContent","textContent","container","textDivs","tagOpen","tagClose","TextLayer","__html","setHtml","textDiv","lineData","startLine","startOffset","start","endLine","endOffset","openStack","lineEle","lineNum","l","substrings","sort","b","escape","substring","splice","findIndex","pop","dangerouslySetInnerHTML","commentBody","editMode","setEditMode","user","getElementById","created_at","toLocaleString","reply_ids","comment_id","urlToValue","home","notifications","library","recents","segValue","split","color","fontWeight","first_name","last_name","email","thumbnail","viewBox","useLocation","book_ids","group_members","find","u","member_type","bio","Link","description","slice","setShowSpinner","catch","finally","g","PageLogin","login","signUp","autoComplete","pattern","TabsRow","child","fontSize","PageRegister","ModalEditGroup","publicPrivate","linkSharing","omit","group_type","stateToGroupType","archiveGroup","groupTypeToState","cloneDeep","manageUsersMode","borderRadius","disabled","origin","isAdmin","groupId","action","accept","onChange","files","PageGroup","PageGroups","PageBook","ModalEditBook","Alert","PdfPublicRightSidebar","pageTops","pageBottoms","prevTopLoadedPage","prevBottomLoadedPage","prevTopPage","prevBottomPage","pageEles","offsetTop","offsetHeight","closest","scrollTo","onScroll","lastPageNum","topLoadOffset","scrollTop","bottomLoadOffset","topLoadedPage","Math","max","bottomLoadedPage","min","topOffset","bottomOffset","getSelection","toString","anchorNode","focusNode","anchorNodeSpan","focusNodeSpan","startPage","dataset","pageIndex","anchorOffset","endPage","focusOffset","pagesDOM","focusNodeClientRect","getBoundingClientRect","scrollNode","top","PdfNotesRightSidebar","note","PdfHighlightRightSidebar","isLocalhost","Boolean","hostname","registerValidSW","swUrl","config","navigator","serviceWorker","register","registration","onupdatefound","installingWorker","installing","onstatechange","controller","onUpdate","onSuccess","ReactDOM","App","URL","process","href","addEventListener","fetch","contentType","get","ready","unregister","reload","checkValidServiceWorker"],"mappings":"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","file":"static/js/main.3db21c3a.chunk.js","sourcesContent":["// TODO: Functional components memo\r\n// TODO: match.params\r\n// TODO: withRouter => hooks\r\n// TODO: useCallback\r\n// TODO: forms onSubmit\r\n\r\nimport React,{createContext,useReducer,useEffect} from 'react'\r\nimport {useHistory} from 'react-router-dom'\r\nimport axios from 'axios'\r\n\r\nimport mainReducer,{initState,state} from '../reducers/mainReducer'\r\nimport {setAlert} from '../utils/components/Alert/Alert'\r\nimport {forceUpdateApp} from '../components/App/App'\r\nimport {StatusCodes} from 'http-status-codes'\r\n\r\nwindow.axios=axios\r\nexport const MainContext=createContext(JSON.parse(initState))\r\nexport const nonAlphaNumericRegex=/[^A-Za-z0-9 ]+/g\r\nexport const passwordRegex='^(?=.*\\\\d)(?=.*[a-z])(?=.*[A-Z]).{6,20}$'\r\n\r\nexport let dispatch\r\nexport let token=true\r\nexport let history\r\n// token is set to a truthy value initially because default assumption is that a user is logged-in before re-login, otherwise login screen would show.\r\nexport function setToken(newToken){\r\n\t// console.log({newToken})\r\n\ttoken=newToken\r\n\ttoken===undefined && forceUpdateApp()\r\n}\r\n\r\nexport default function MainContextProvider({children}){\r\n\thistory=useHistory()\r\n\r\n\tlet state\r\n\t([state,dispatch]=useReducer(mainReducer,JSON.parse(initState)))\r\n\tuseEffect(()=>{ componentDidMount() },[]) // eslint-disable-line react-hooks/exhaustive-deps\r\n\r\n\tfunction componentDidMount(){\r\n\t\tif(history.location.pathname.indexOf('/login')===-1) reLogin()\r\n\t\telse setToken(undefined)\r\n\t}\r\n\r\n\treturn <MainContext.Provider value={state}>{children}</MainContext.Provider>\r\n}\r\n\r\nexport async function api(method,url,data){\r\n\tconst o={\r\n\t\turl: state.url+url,\r\n\t\tmethod,\r\n\t\tdata,\r\n\t\theaders: { Authorization: 'Bearer '+token },\r\n\t\twithCredentials: true, // TODO: Check if safe to send credentials with every api call\r\n\t}\r\n\t// token && (o.headers['Authorization']='Bearer '+token)\r\n\r\n\ttry{\r\n\t\tconst res=await axios(o)\r\n\t\tres.data.token && setToken(res.data.token)\r\n\t\treturn res.data\r\n\t}catch(err){ onError(err) } // TODO: Handle 401\r\n}\r\n\r\nfunction onError(e){\r\n\tconsole.log(e,e.response)\r\n\tsetAlert(<div className=\"row spc-12\" style={{width: 320}}>\r\n\t\t<div className=\"col-12 h5\">&#xf071; Error</div>\r\n\t\t<div className=\"col-12 h7 text-muted\">\r\n\t\t\t{e.response?.data?.message?\r\n\t\t\t\t<div>{e.response.data.message}</div>:\r\n\t\t\t\t<div>Network error. If you can, try that again please.</div>}\r\n\t\t</div>\r\n\t\t<div className=\"bottom-row col-ext-x col-ext-b col-12 row spc-x-12 spc-y-8 f-justify-end\">\r\n\t\t\t<button onClick={()=>setAlert()}>Close</button>\r\n\t\t</div>\r\n\t</div>)\r\n\tthrow e\r\n}\r\n\r\nexport async function apiWithRetry(...params){\r\n\tlet loop=true\r\n\tdo{\r\n\t\tloop=false\r\n\t\ttry{\r\n\t\t\treturn await api(...params)\r\n\t\t}catch(err){\r\n\t\t\tif(!err.response || err.response.status!==StatusCodes.UNAUTHORIZED)\r\n\t\t\t\tif(await showRetry(err))\r\n\t\t\t\t\tloop=true\r\n\t\t}\r\n\t}while(loop)\r\n}\r\n\r\nexport async function showRetry(err){\r\n\treturn await new Promise(resolve=>setAlert(<div className=\"row spc-12\" style={{width: 320}}>\r\n\t\t<div className=\"col-12 h5\">&#xf071; Error</div>\r\n\t\t<div className=\"col-12 h7 text-muted\">\r\n\t\t\t{err.response?.data?.message?\r\n\t\t\t\t<div>{err.response.data.message}</div>:\r\n\t\t\t\t<div>Network error. If you can, try that again please.</div>}\r\n\t\t</div>\r\n\t\t<div className=\"bottom-row col-ext-x col-ext-b col-12 row spc-x-12 spc-y-8 f-justify-end\">\r\n\t\t\t<button className=\"outline\" onClick={()=>{setAlert();resolve(false)}}>Cancel</button>\r\n\t\t\t<button onClick={()=>{setAlert();resolve(true)}}>Retry</button>\r\n\t\t</div>\r\n\t</div>))\r\n}\r\n\r\n// TODO: Splash Screen\r\nasync function reLogin(){\r\n\tconst data=await apiWithRetry('post','refresh')\r\n\tdata?\r\n\t\tdispatch(['LOGIN',data.data]):\r\n\t\tsetToken(undefined) // STRATEGY: show login screen if no token / userId\r\n}\r\n\r\n// TODO: Show Spinner\r\nexport async function logout(){\r\n\tawait apiWithRetry('post','logout')\r\n\tsetToken(undefined)\r\n\tdispatch(['SET_STATE',JSON.parse(initState)])\r\n}\r\n","import React,{useContext} from 'react'\r\nimport {useParams} from 'react-router-dom'\r\nimport {useLocal,useMemoObject} from './hooks'\r\nimport _ from 'lodash'\r\n\r\n/**\r\n * Adds router `params` object to props.\r\n * The params object passed is memoized, so is only updated when at-least one URL parameter changes.\r\n * `AnimatedRoute` supported.\r\n * Debug version: `withParamsMemoizedDebug`\r\n */\r\nexport const withParamsMemoized=Component=>props=>\r\n\t<Component {...props} params={useMemoObject(props.animatedProps?._match.params || useParams())}/>\r\n\r\n/**\r\n * Adds router `params` object to props.\r\n * The params object passed is memoized, so is only updated when at-least one URL parameter changes.\r\n * `AnimatedRoute` supported.\r\n */\r\nexport const withParamsMemoizedDebug=Component=>props=>{\r\n\tconst oldParams=useLocal()\r\n\tlet params=useLocal()\r\n\tconst newParams=props.animatedProps?._match.params || useParams()\r\n\r\n\tconst changed=[]\r\n\tconst oldVals=[]\r\n\tconst newVals=[]\r\n\tfor(let i in newParams){\r\n\t\tparams[i]=newParams[i]\r\n\t\tif(oldParams[i]!==newParams[i]){\r\n\t\t\tchanged.push(i)\r\n\t\t\toldVals.push(oldParams[i])\r\n\t\t\tnewVals.push(newParams[i])\r\n\t\t\toldParams[i]=newParams[i]\r\n\t\t}\r\n\t}\r\n\tif(changed.length){\r\n\t\tconsole.log('withParamsMemoizedDebug: Changed',changed,oldVals,newVals)\r\n\t\tparams={...params}\r\n\t}\r\n\treturn <Component {...props} {...{params}}/>\r\n}\r\n\r\n/**\r\n * Feeds only requested context variables into props of component.\r\n * By feeding only required variables, we can reduce re-renders on pure / memoized components.\r\n * Debug version: `withContextDebug`\r\n */\r\nexport const withContext=(Context,dependencies,Component)=>\r\n\tprops=><Component {...props} {..._.pick(useContext(Context),dependencies)}/>\r\n\r\n/**\r\n * Feeds only requested context variables into props of component.\r\n * By feeding only required variables, we can reduce re-renders on pure / memoized components.\r\n */\r\nexport const withContextDebug=(Context,dependencies,Component)=>\r\n\tprops=>{\r\n\t\tconst contextProps=_.pick(useContext(Context),dependencies)\r\n\t\tconsole.log('withContextDebug:',{contextProps,dependencies,Context})\r\n\t\treturn <Component {...props} {...contextProps}/>\r\n\t}\r\n","module.exports = __webpack_public_path__ + \"static/media/tab-start.7684764d.svg\";","import React,{useState} from 'react'\r\nimport {withRouter} from 'react-router-dom'\r\n\r\nexport let setAlert\r\n\r\n// TODO: Maybe easier alert, prompt, confirm\r\n// TODO: UseEffect scrollbar fix\r\nexport default withRouter(function Alert(){\r\n\tlet alert\r\n\t[alert,setAlert]=useState()\r\n\treturn (\r\n\t\t<div id=\"Alert\" className={'modal'+(alert?' active':' ')}>\r\n\t\t\t{alert?<div style={{minWidth: 320,maxWidth: 'calc(100% - 24px)',maxHeight: 'calc(100% - 24px)'}}>\r\n\t\t\t\t<div className=\"close-btn\" onClick={()=>setAlert()}/>\r\n\t\t\t\t{alert}\r\n\t\t\t</div>:undefined}\r\n\t\t</div>\r\n\t)\r\n})","import {useState,useEffect} from 'react'\r\n\r\n/**\r\n * Provides a mutable object that is similar to `this` pointer in class components.\r\n * Local object persists between renders and does not cause a re-render if changed.\r\n */\r\nexport const useLocal=(initialState={})=>useState(initialState)[0]\r\n\r\nexport function useForceUpdate(){\r\n\tconst setState=useState()[1]\r\n\treturn ()=>setState({})\r\n}\r\n\r\n/**\r\n * Gives a unique ID for each component instance.\r\n */\r\nexport const useInstanceId=()=>useState(()=>Math.floor(0b111111111111111111111111111111*Math.random()))[0]\r\n\r\n/**\r\n * Similar to `useEffect`, but executes before render.\r\n * `usePreEffect` helps you avoid `setState` in some non-async cases, hence reducing renders.\r\n * Avoid `setState` inside non-async `usePreEffect` as the component is already about to render, set `local.state=value` via `useLocal` instead.\r\n * Debug version: `usePreEffectDebug`\r\n */\r\nexport function usePreEffect(deps,effect){\r\n\tconst oldDeps=useLocal([])\r\n\tconst prevDeps=[...oldDeps]\r\n\tconst changed=[]\r\n\tlet didChange=false\r\n\tfor(let i in deps)\r\n\t\t(changed[i]=oldDeps[i]!==deps[i])\r\n\t\t\t&& (didChange=true)\r\n\t\t\t&& (oldDeps[i]=deps[i])\r\n\tdidChange && effect(deps,prevDeps,changed)\r\n}\r\n\r\n/**\r\n * Introduces lifecycle methods into the component.\r\n */\r\nexport function useLifecycle({componentWillMount,componentDidMount,componentWillUnmount}){\r\n\tconst type=typeof componentWillUnmount\r\n\tif(componentWillUnmount && type!=='function')\r\n\t\tthrow new Error('useLifecycle: componentWillUnmount must be a function. (Got: `'+type+'`)')\r\n\r\n\tuseState(componentWillMount)\r\n\tuseEffect(()=>{\r\n\t\tcomponentDidMount && componentDidMount()\r\n\t\treturn componentWillUnmount\r\n\t},[]) // eslint-disable-line react-hooks/exhaustive-deps\r\n}\r\n\r\n// TODO-FUTURE: Comparator function\r\n/**\r\n * Returns a memoized object if passed object has same values from previous render (shallow compare).\r\n * Especially useful for sending object props to pure / memoized components.\r\n * Debug version: `useMemoObjectDebug`\r\n */\r\nexport function useMemoObject(obj){\r\n\tconst oldObj=useLocal()\r\n\tconst newObj=useLocal()\r\n\tlet changed=false\r\n\tfor(let i in obj){\r\n\t\tnewObj[i]=obj[i]\r\n\t\toldObj[i]!==obj[i]\r\n\t\t\t&& (changed=true)\r\n\t\t\t&& (oldObj[i]=obj[i])\r\n\t}\r\n\treturn changed?{...newObj}:newObj\r\n}\r\n\r\n// TODO: useMemoArray\r\n","import React,{useRef} from 'react'\r\n\r\nimport './Spinner.scss'\r\n\r\nexport default function Spinner({className,ref={}}){\r\n\tref=useRef()\r\n\treturn (\r\n\t\t<div className={'spinner pos-abs stretch-to-fit super-center '+className} {...{ref}}>\r\n\t\t\t<img className=\"p-8\" src={require('../../../assets/imgs/spinner.gif')} alt=\"Spinner\"/>\r\n\t\t</div>\r\n\t)\r\n}","import React from 'react'\r\nimport {withRouter} from 'react-router-dom'\r\nimport {Scrollbar} from 'react-scrollbars-custom'\r\n\r\nimport './CommentThread.scss'\r\nimport Comment from '../Comment/Comment'\r\nimport MyComponent from '../MyComponent'\r\nimport {MainContext,nonAlphaNumericRegex,api,dispatch} from '../../contexts/MainContext'\r\n\r\nconst initState=JSON.stringify({\r\n\tbody: '',\r\n\thashtags: '',\r\n})\r\nexport default withRouter(class CommentThread extends MyComponent{\r\n\tstatic contextType=MainContext\r\n\tstate=JSON.parse(initState)\r\n\r\n\tonSubmit=e=>{\r\n\t\te.preventDefault()\r\n\t\tconst commentId=this.props.match.params.id\r\n\t\tconst {body,hashtags}=this.state\r\n\t\tconst {COMMENTS,userId}=this.context\r\n\t\tconst comment=COMMENTS[commentId]\r\n\t\tapi('post','comment',{\r\n\t\t\tbody,\r\n\t\t\thashtags: hashtags.replace(nonAlphaNumericRegex,'').trim(),\r\n\t\t\tuser_id: userId,\r\n\t\t\tbook_id: comment.book_id,\r\n\t\t\treply_to_id: commentId,\r\n\t\t\tcomment_type: 'reply'\r\n\t\t}).then(async ()=>{\r\n\t\t\t// COMMENTS[commentId].reply_ids.push(data.id)\r\n\t\t\t// console.log({comments: [data,COMMENTS[commentId]]})\r\n\t\t\t// const book=BOOKS[comment.book]\r\n\t\t\t// book.comment_ids.push(data.id)\r\n\t\t\t// dispatch(['SET_DATA',{comments: [data,COMMENTS[commentId]],books: [book]}])\r\n\r\n\t\t\t// dispatch(['SET_DATA',data])\r\n\t\t\tconst {data}=await api('get','book-full/'+comment.book_id)\r\n\t\t\tdata && dispatch(['SET_DATA',data])\r\n\t\t\tthis.setState(JSON.parse(initState))\r\n\t\t})\r\n\t}\r\n\r\n\trender(){\r\n\t\t// console.log(this.props)\r\n\t\tconst {onSubmit}=this\r\n\t\tconst {history,match}=this.props\r\n\t\tconst commentId=match.params.id\r\n\t\tconst {userId,USERS}=this.context\r\n\r\n\t\treturn (\r\n\t\t\t<div className=\"CommentThread pos-abs stretch-to-fit row spc-12 f-justify-end\">\r\n\t\t\t\t<div className=\"p-12 f-start f-justify-end f-self-start\">\r\n\t\t\t\t\t<div className=\"h5 icon icon-cross_mark\" onClick={history.goBack} style={{cursor: 'pointer'}}/>\r\n\t\t\t\t</div>\r\n\t\t\t\t<Scrollbar disableTracksWidthCompensation className=\"thread-container col\" style={{height: 'auto'}}>\r\n\t\t\t\t\t<div className=\"row spc-12 f-vert pos-rel\">\r\n\t\t\t\t\t\t<Comment {...{commentId,showChildren: true}}>\r\n\t\t\t\t\t\t\t<div className=\"reply-input\">\r\n\t\t\t\t\t\t\t\t<div className=\"top-row row pb-4 f-justify-end\">\r\n\t\t\t\t\t\t\t\t\t<div className=\"col\"/>\r\n\t\t\t\t\t\t\t\t\t<div className=\"h7 text-muted\">@{USERS[userId]?.username || 'Username'}</div>\r\n\t\t\t\t\t\t\t\t\t<img className=\"pos-rel\" src={require('../../assets/imgs/default-profile-icon.jpg')} alt=\"User icon\"/>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t<form className=\"form row spc-12\" {...{onSubmit}}>\r\n\t\t\t\t\t\t\t\t\t<div className=\"h7 col-12 my-2\">Add reply</div>\r\n\t\t\t\t\t\t\t\t\t<textarea required className=\"col-12\" cols=\"30\" rows=\"10\" placeholder=\"Reply\" {...this.twoWayBind('body')}/>\r\n\t\t\t\t\t\t\t\t\t<input type=\"text\" className=\"col\" placeholder=\"#Hashtag\" {...this.twoWayBind('hashtags')}/>\r\n\t\t\t\t\t\t\t\t\t<button>Post</button>\r\n\t\t\t\t\t\t\t\t</form>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</Comment>\r\n\t\t\t\t\t\t{/*<div style={{height: '1000px'}}/>*/}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</Scrollbar>\r\n\t\t\t</div>\r\n\t\t)\r\n\t}\r\n})\r\n","import React from 'react'\r\nimport {Route} from 'react-router-dom'\r\nimport {useForceUpdate,useLocal} from '../hooks'\r\n\r\nconst stateEnum={\r\n\t'1':  'Entering',\r\n\t'2':  'Entered',\r\n\t'-1': 'Exiting',\r\n\t'-2': 'Exited',\r\n\r\n\tEntering: 1,\r\n\tEntered:  2,\r\n\tExiting:  -1,\r\n\tExited:   -2,\r\n}\r\n\r\n/**\r\n * Introduces animation lifecycle events for `Route`.\r\n * The animation data, lifecycle callbacks, etc. are passed via `animatedProps`.\r\n * The animation lifecycle events are built such that they do not cause re-renders, which is great while optimizing renders.\r\n * @example <AnimatedRoute path=\"/some/path\" timeout={{enter: 500,exit 1000}} render={Component}>\r\n */\r\nconst AnimatedRoute=({children,component,render,timeout=0,...props})=>{\r\n\tconst forceUpdate=useForceUpdate()\r\n\tconst local=useLocal({\r\n\t\tstateEnum,\r\n\t\tstate:        'Exited',\r\n\t\tstateNumeric: -2,\r\n\t\t_match: undefined, // Do not rely on this inside pure / memoized components. This will not cause re-renders.\r\n\r\n\t\ttimeStamp:         0,\r\n\t\tcomponentDidEnter: undefined,\r\n\t\tcomponentWillExit: undefined,\r\n\t})\r\n\r\n\ttypeof timeout==='number' && (timeout={enter: timeout,exit: timeout})\r\n\ttimeout.enter ?? (timeout.enter=0)\r\n\ttimeout.exit ?? (timeout.exit=0)\r\n\tlocal.timeout=timeout\r\n\r\n\treturn <Route {...props} children={renderChildren}/>\r\n\r\n\tfunction setLocalState(stateNumeric){\r\n\t\tlocal.stateNumeric=stateNumeric\r\n\t\tlocal.state=stateEnum[stateNumeric]\r\n\t\tswitch(stateNumeric){\r\n\t\t\tcase +2:\r\n\t\t\t\tlocal.componentDidEnter && local.componentDidEnter()\r\n\t\t\t\tbreak\r\n\t\t\tcase -1:\r\n\t\t\t\tlocal.componentWillExit && local.componentWillExit()\r\n\t\t\t\tbreak\r\n\t\t\tcase -2:\r\n\t\t\t\tforceUpdate()\r\n\t\t\t\tlocal.componentDidEnter=undefined\r\n\t\t\t\tlocal.componentWillExit=undefined\r\n\t\t\t\tbreak\r\n\t\t\tdefault: break\r\n\t\t}\r\n\t}\r\n\tfunction setEntering(){\r\n\t\tif(timeout.enter>0){\r\n\t\t\tsetLocalState(1)\r\n\t\t\tlocal.timeStamp=Date.now()\r\n\t\t\twindow.setTimeout(setEntered,timeout.enter)\r\n\t\t}else setLocalState(2)\r\n\t}\r\n\tfunction setEntered(){\r\n\t\tlocal.stateNumeric===1 &&\r\n\t\tDate.now()>=local.timeStamp+timeout.enter &&\r\n\t\tsetLocalState(2)\r\n\t}\r\n\tfunction setExiting(){\r\n\t\tif(timeout.exit>0){\r\n\t\t\tsetLocalState(-1)\r\n\t\t\tlocal.timeStamp=Date.now()\r\n\t\t\twindow.setTimeout(setExited,timeout.exit)\r\n\t\t}else setLocalState(-2)\r\n\t}\r\n\tfunction setExited(){\r\n\t\tlocal.stateNumeric=== -1 &&\r\n\t\tDate.now()>=local.timeStamp+timeout.exit &&\r\n\t\tsetLocalState(-2)\r\n\t}\r\n\tfunction renderChildren({match}){\r\n\t\tmatch!==null && local.stateNumeric<0 && (local._match=match) && setEntering()\r\n\t\tmatch===null && local.stateNumeric>0 && setExiting()\r\n\t\tconst C=render\r\n\t\treturn local.stateNumeric!== -2?<C animatedProps={local}/>:null\r\n\t}\r\n}\r\n\r\nexport default AnimatedRoute","import React,{createContext,memo,useEffect,useRef,useState} from 'react'\r\nimport {Route,Link} from 'react-router-dom'\r\nimport {Scrollbar} from 'react-scrollbars-custom'\r\nimport _ from 'lodash'\r\n\r\nimport './PageBook.scss'\r\nimport Header from '../Header/Header'\r\nimport SegmentControls from '../../utils/components/SegmentControls/SegmentControls'\r\nimport tabStart from '../../assets/imgs/tab-start.svg'\r\nimport Comment from '../Comment/Comment'\r\nimport CommentThread from '../CommentThread/CommentThread'\r\nimport {MainContext,api,dispatch,history} from '../../contexts/MainContext'\r\nimport Spinner from '../../utils/components/Spinner/Spinner'\r\nimport pdfjs,{PdfImage,TextLayer} from '../PdfRenderer/PdfRenderer'\r\nimport MyComponent from '../MyComponent'\r\nimport {useLifecycle,useLocal,usePreEffect} from '../../utils/hooks'\r\nimport {withParamsMemoized,withContext} from '../../utils/hocs'\r\nimport AnimatedRoute from '../../utils/components/AnimatedRoute'\r\n\r\nexport const BookContext=createContext({})\r\n\r\nconst PdfVerticalScroll=require('../PdfVerticalScroll/PdfVerticalScroll').default\r\n\r\nconst rightSidebars={\r\n\t'question' : require('../PdfPublicRightSidebar/PdfPublicRightSidebar').default,\r\n\t'comment'  : require('../PdfPublicRightSidebar/PdfPublicRightSidebar').default,\r\n\t'note'     : require('../PdfNotesRightSidebar/PdfNotesRightSidebar').default,\r\n\t'highlight': require('../PdfHighlightRightSidebar/PdfHighlightRightSidebar').default,\r\n}\r\n\r\nexport const publicPrivateModes={\r\n\t'question' : 'public',\r\n\t'comment'  : 'public',\r\n\t'note'     : 'private',\r\n\t'highlight': 'private',\r\n}\r\nconst categorizedInitState=JSON.stringify({\r\n\t'question' : [],\r\n\t'comment'  : [],\r\n\t'note'     : [],\r\n\t'highlight': [],\r\n}) // Categorizing comments based on type, only main categories need to be initialized as above\r\n\r\nexport default withParamsMemoized(withContext(MainContext,[\r\n\t'userId',\r\n\t'BOOKS',\r\n\t'GROUPS',\r\n\t'COMMENTS',\r\n\t'SELECTIONS',\r\n],memo(function PageBook({\r\n\tparams,\r\n\r\n\tuserId,\r\n\tBOOKS,\r\n\tGROUPS,\r\n\tCOMMENTS,\r\n\tSELECTIONS,\r\n}){\r\n\tconsole.log('render')\r\n\r\n\tconst ref=useRef()\r\n\tconst visiblePagesStylesRef=useRef()\r\n\r\n\tconst book=BOOKS[params.bookId]\r\n\tconst group=GROUPS[book?.group_id]\r\n\r\n\tconst local=useLocal({\r\n\t\t// TODO: Use proxy object\r\n\t\ttopMostVisiblePage:     undefined, // CSS variable\r\n\t\tbottomMostVisiblePage:  undefined, // CSS variable\r\n\t\tvisiblePagesStyles:     undefined, // CSS\r\n\t\tpageWiseCommentsBefore: undefined, // Initialized in PublicRightSidebar render\r\n\t\tpageWiseCommentsAfter:  undefined, // Initialized in PublicRightSidebar render\r\n\r\n\t\tpdf:          undefined, // Initialized in PageBook after PDF is downloaded & loaded. Needed in componentWillUnmount.\r\n\t\tsetBubblePos: undefined, // Initialized in NewCommentBubble before first render.\r\n\r\n\t\tcategorized:      JSON.parse(categorizedInitState),\r\n\t\tpageWiseComments: {},\r\n\t})\r\n\tuseLifecycle({componentWillUnmount})\r\n\r\n\tconst [sidebarMode,setSidebarMode]=useState('comment') // TODO: Change to path variable\r\n\tconst [selection  ,setSelection  ]=useState()\r\n\tconst [pdf        ,setPdf        ]=useState()\r\n\r\n\tconst publicPrivateMode=publicPrivateModes[sidebarMode]\r\n\r\n\tuseEffect(()=>{ refresh() },[params.bookId+userId])\r\n\t// Due to base64, we are using book.id. Assumption is book.file is unique for book.id\r\n\tuseEffect(()=>{ loadPdf() },[book?.id]) // eslint-disable-line react-hooks/exhaustive-deps\r\n\tusePreEffect([book?.comment_ids],categorizedAndPageWiseComments)\r\n\r\n\tconst RightSidebar=rightSidebars[sidebarMode]\r\n\treturn <BookContext.Provider value={{\r\n\t\tbook,\r\n\t\tcategorized: local.categorized,\r\n\t\tgroup,\r\n\t\tBookContextLocal: local,\r\n\t\tpageWiseComments: local.pageWiseComments,\r\n\t\tpdf,\r\n\t\tpublicPrivateMode,\r\n\t\tref,\r\n\t\tselection,\r\n\t\tsetBubblePos: local.setBubblePos,\r\n\t\tsetSelection,\r\n\t\tsetSidebarMode,\r\n\t\tsetVisiblePages,\r\n\t\tsidebarMode,\r\n\t\tuserId,\r\n\t\tvisiblePagesStylesRef,\r\n\t}}>\r\n\t\t<div className=\"PageBook pos-abs stretch-to-fit f-vert\" ref={ref} style={{\r\n\t\t\t'--topMostVisiblePage': local.topMostVisiblePage,\r\n\t\t\t'--bottomMostVisiblePage': local.bottomMostVisiblePage,\r\n\t\t\t'--commentsBefore': local.pageWiseCommentsBefore?.[local.topMostVisiblePage],\r\n\t\t\t'--commentsAfter': local.pageWiseCommentsAfter?.[local.bottomMostVisiblePage],\r\n\t\t}}>\r\n\t\t\t<style ref={visiblePagesStylesRef}>{local.visiblePagesStyles}</style>\r\n\t\t\t<section className=\"row main-section\">\r\n\t\t\t\t<div className=\"col left-sidebar pos-rel\">\r\n\t\t\t\t\t<PdfVerticalScroll/>\r\n\t\t\t\t\t<Spinner className={pdf?.pdf?'':'active'}/>\r\n\t\t\t\t</div>\r\n\t\t\t\t<RightSidebar {...{sidebarMode}}/>\r\n\t\t\t</section>\r\n\t\t\t<Header>\r\n\t\t\t\t<div className=\"icon icon-arrow_left f-order-m1 super-center\" onClick={history.goBack}/>\r\n\t\t\t\t<div className=\"col\"/>\r\n\t\t\t\t<SegmentControls className=\"mr-12\" value={publicPrivateMode==='public'?1:0} style={{width: '200px'}}>\r\n\t\t\t\t\t<div className=\"super-center capitalize\" onClick={()=>setSidebarMode('note')}>Private</div>\r\n\t\t\t\t\t<div className=\"super-center capitalize\" onClick={()=>setSidebarMode('comment')}>Public</div>\r\n\t\t\t\t</SegmentControls>\r\n\t\t\t\t<div className=\"col-ext row spc-x-8\" style={{maxWidth: 'var(--rightSidebarWidth)'}}>\r\n\t\t\t\t\t<div className=\"col text-right mr-12 one-line f-vert f-justify-center\">\r\n\t\t\t\t\t\t<h5 className=\"col-12 b-700 one-line\">{book?book.title:'PageBook Title'}</h5>\r\n\t\t\t\t\t\t<div className=\"h7 text-muted one-line\">Group: {group?group.title:'Group Title'}</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div className=\"icon icon-refresh super-center\" onClick={refresh}/>\r\n\t\t\t\t</div>\r\n\t\t\t</Header>\r\n\t\t\t<Route path=\"*/thread/:id\" component={CommentThread}/>\r\n\t\t\t<AnimatedRoute path=\"*/new-comment\" timeout={{exit: 1000}} render={NewPublicComment}/>\r\n\t\t</div>\r\n\t</BookContext.Provider>\r\n\r\n\tasync function refresh(){\r\n\t\tif(userId===null) return\r\n\t\ttry{\r\n\t\t\tconst {data}=await api('get','book-full/'+params.bookId)\r\n\t\t\tdata && dispatch(['SET_DATA',data])\r\n\t\t}finally{}\r\n\t}\r\n\r\n\tasync function loadPdf(){\r\n\t\t// console.log('PageBook loadPdf')\r\n\t\tconst file=book?.file\r\n\t\tif(file){\r\n\t\t\tconst pdfLoadTask=pdfjs.getDocument(file)\r\n\t\t\tpdfLoadTask.onProgress=({loaded,total})=>console.log(loaded/total*100)\r\n\t\t\t// console.log(pdfLoadTask)\r\n\t\t\tconst pdf=await pdfLoadTask.promise\r\n\t\t\t// console.log(pdf)\r\n\t\t\tconst promises=new Array(pdf.numPages)\r\n\t\t\tfor(let i=0;i<promises.length;++i) promises[i]=pdf.getPage(i+1)\r\n\t\t\tconst pages=await Promise.all(promises)\r\n\t\t\tconst viewports=generateViewports(pages,1.5)\r\n\t\t\t// console.log(pages,viewports)\r\n\t\t\tsetPdf({pdf,pages,viewports})\r\n\t\t\tlocal.pdf={pdf,pages,viewports}\r\n\t\t}\r\n\t}\r\n\r\n\tfunction categorizedAndPageWiseComments([comment_ids]){\r\n\t\tlocal.categorized=JSON.parse(categorizedInitState)\r\n\t\tconst allComments=[]\r\n\t\tcomment_ids?.forEach(c=>{ // eslint-disable-line no-unused-expressions\r\n\t\t\tc=COMMENTS[c]\r\n\t\t\tif(!c) return\r\n\t\t\tif(!local.categorized[c.comment_type]) local.categorized[c.comment_type]=[]\r\n\t\t\tif(!c.hidden){\r\n\t\t\t\tlocal.categorized[c.comment_type].push(c)\r\n\t\t\t\tallComments.push(c)\r\n\t\t\t}\r\n\t\t})\r\n\r\n\t\tlocal.pageWiseComments={}\r\n\t\tallComments.forEach(c=>{\r\n\t\t\t(SELECTIONS[c.id] || []).forEach(s=>s?.data.forEach(p=>{\r\n\t\t\t\tconst pageNum=+p.page\r\n\t\t\t\tif(!local.pageWiseComments[pageNum]) local.pageWiseComments[pageNum]=[]\r\n\t\t\t\tlocal.pageWiseComments[pageNum].push(c)\r\n\t\t\t}))\r\n\t\t})\r\n\t}\r\n\r\n\t// re-use when zooming\r\n\tfunction generateViewports(pages,scale){\r\n\t\treturn pages.map(p=>p.getViewport({scale}))\r\n\t}\r\n\r\n\tfunction setVisiblePages(topPage,bottomPage){\r\n\t\tlocal.topMostVisiblePage=topPage\r\n\t\tlocal.bottomMostVisiblePage=bottomPage\r\n\t\tconst styles=[]\r\n\t\t// TODO: change to translate() for smoothness\r\n\t\tfor(let i=topPage;i<=bottomPage;++i)\r\n\t\t\tstyles.push(`\r\n\t\t\t\t#page-${i}-comments.PageWiseComments{ height: var(--height) !important }\r\n\t\t\t`)\r\n\t\tlocal.visiblePagesStyles=styles.join('')\r\n\t\tsetCssFromIState()\r\n\t}\r\n\r\n\tfunction setCssFromIState(){\r\n\t\tif(ref){\r\n\t\t\tref.current.style.setProperty('--topMostVisiblePage',local.topMostVisiblePage)\r\n\t\t\tref.current.style.setProperty('--bottomMostVisiblePage',local.bottomMostVisiblePage)\r\n\t\t\tref.current.style.setProperty('--commentsBefore',local.pageWiseCommentsBefore[local.topMostVisiblePage])\r\n\t\t\tref.current.style.setProperty('--commentsAfter',local.pageWiseCommentsAfter[local.bottomMostVisiblePage])\r\n\t\t\t// console.log(local.pageWiseCommentsBefore,local.pageWiseCommentsAfter)\r\n\t\t}\r\n\t\tif(visiblePagesStylesRef){\r\n\t\t\tvisiblePagesStylesRef.current.innerHTML=local.visiblePagesStyles\r\n\t\t}\r\n\t}\r\n\r\n\tfunction componentWillUnmount(){\r\n\t\tlocal.pdf?.pdf?.destroy() // eslint-disable-line no-unused-expressions\r\n\t}\r\n})))\r\n\r\nconst PublicRightSidebar=withContext(BookContext,[\r\n\t'publicPrivateMode',\r\n\t'sidebarMode',\r\n\t'setSidebarMode',\r\n\t'categorized',\r\n\t'pageWiseComments',\r\n\t'userId',\r\n\t'pdf',\r\n\t'BookContextLocal',\r\n],memo(function PublicRightSidebar({\r\n\tpublicPrivateMode,\r\n\tsidebarMode,\r\n\tsetSidebarMode,\r\n\tcategorized,\r\n\tpageWiseComments,\r\n\tuserId,\r\n\tpdf,\r\n\tBookContextLocal,\r\n}){\r\n\tconst [myComments,setMyComments]=useState(false) // All comments / My Comments\r\n\t// const [publicSearchString,setPublicSearchString]=useState('')\r\n\r\n\tlet pageWiseCommentsTotal=0\r\n\tconst filtered=_.mapValues(pageWiseComments,p=>p.filter(comment=>{\r\n\t\tconst isValidResult=(\r\n\t\t\t// TODO: Backend send only user notes and remove below || publicPrivateMode==='private'\r\n\t\t\t(comment.comment_type===sidebarMode)                                                          // eslint-disable-line no-mixed-operators\r\n\t\t\t&& (!myComments || (myComments || publicPrivateMode==='private') && comment.user_id===userId) // eslint-disable-line no-mixed-operators\r\n\t\t\t// && (comment.hashtags.indexOf(publicSearchString)!==-1) // TODO: Lowercase\r\n\t\t)\r\n\t\tisValidResult && ++pageWiseCommentsTotal\r\n\t\treturn isValidResult\r\n\t}))\r\n\r\n\tlet temp=pageWiseCommentsTotal\r\n\tlet prevI=0\r\n\tBookContextLocal.pageWiseCommentsBefore=[]\r\n\tBookContextLocal.pageWiseCommentsAfter=[]\r\n\treturn <div className={`RightSidebar row pos-rel p-12 pl-0 mode-${sidebarMode}`}>\r\n\t\t<div className=\"vertical-tabs f-vert\">\r\n\t\t\t<div className=\"col\" style={{maxHeight: '14px'}}/>\r\n\t\t\t{publicPrivateMode==='public'?<>\r\n\t\t\t\t<div className={sidebarMode==='question'?'active':''} onClick={()=>setSidebarMode('question')}>\r\n\t\t\t\t\t<img src={tabStart} alt=\"\"/>\r\n\t\t\t\t\t<div className=\"vertical-text px-4\">Questions <span className=\"h7\">\r\n\t\t\t\t\t\t{categorized['question'].length}\r\n\t\t\t\t\t</span></div>\r\n\t\t\t\t\t<img src={tabStart} alt=\"\"/>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className={sidebarMode==='comment'?'active':''} onClick={()=>setSidebarMode('comment')}>\r\n\t\t\t\t\t<img src={tabStart} alt=\"\"/>\r\n\t\t\t\t\t<div className=\"vertical-text px-4\">Comments <span className=\"h7\">\r\n\t\t\t\t\t\t{categorized['comment'].length}\r\n\t\t\t\t\t</span></div>\r\n\t\t\t\t\t<img src={tabStart} alt=\"\"/>\r\n\t\t\t\t</div>\r\n\t\t\t</>:<>\r\n\t\t\t\t<div className={sidebarMode==='note'?'active':''} onClick={()=>setSidebarMode('note')}>\r\n\t\t\t\t\t<img src={tabStart} alt=\"\"/>\r\n\t\t\t\t\t<div className=\"vertical-text px-4\">Notes <span className=\"h7\">\r\n\t\t\t\t\t\t{categorized['note'].length}\r\n\t\t\t\t\t</span></div>\r\n\t\t\t\t\t<img src={tabStart} alt=\"\"/>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className={sidebarMode==='highlight'?'active':''} onClick={()=>setSidebarMode('highlight')}>\r\n\t\t\t\t\t<img src={tabStart} alt=\"\"/>\r\n\t\t\t\t\t<div className=\"vertical-text px-4\">Highlights <span className=\"h7\">\r\n\t\t\t\t\t\t{categorized['highlight'].length}\r\n\t\t\t\t\t</span></div>\r\n\t\t\t\t\t<img src={tabStart} alt=\"\"/>\r\n\t\t\t\t</div>\r\n\t\t\t</>}\r\n\t\t\t<span className=\"col\"/>\r\n\t\t</div>\r\n\t\t<div className=\"col trim\">\r\n\t\t\t<Scrollbar disableTracksWidthCompensation>\r\n\t\t\t\t<div className=\"py-6 f-vert\">\r\n\t\t\t\t\t{_.map(filtered,(p,i)=>{\r\n\t\t\t\t\t\t// TODO: Fix\r\n\t\t\t\t\t\tconst temp2=pageWiseCommentsTotal-temp\r\n\t\t\t\t\t\tfor(let j=prevI;j<i;++j){\r\n\t\t\t\t\t\t\tBookContextLocal.pageWiseCommentsBefore[j]=temp2\r\n\t\t\t\t\t\t\tBookContextLocal.pageWiseCommentsAfter[j]=temp\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tprevI=i\r\n\t\t\t\t\t\tif(p.length){\r\n\t\t\t\t\t\t\tBookContextLocal.pageWiseCommentsBefore[i]=temp2\r\n\t\t\t\t\t\t\ttemp-=p.length\r\n\t\t\t\t\t\t\tBookContextLocal.pageWiseCommentsAfter[i]=temp\r\n\t\t\t\t\t\t\treturn <PageWiseComments {...{p,i}} key={i}/>\r\n\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\tBookContextLocal.pageWiseCommentsBefore[i]=temp2\r\n\t\t\t\t\t\t\tBookContextLocal.pageWiseCommentsAfter[i]=temp\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})}\r\n\t\t\t\t\t{(()=>{\r\n\t\t\t\t\t\tconst temp2=pageWiseCommentsTotal-temp\r\n\t\t\t\t\t\tfor(let j=prevI;j<pdf?.pages.length;++j){\r\n\t\t\t\t\t\t\tBookContextLocal.pageWiseCommentsBefore[j]=temp2\r\n\t\t\t\t\t\t\tBookContextLocal.pageWiseCommentsAfter[j]=temp\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})()}\r\n\t\t\t\t\t<hr className=\"mx-12\"/>\r\n\t\t\t\t\t<div style={{height: '28px'}}/>\r\n\t\t\t\t\t<div className=\"pos-sty top-controls f-order-m1 f-vert mt-m6\">\r\n\t\t\t\t\t\t{sidebarMode!=='highlight'?<div className=\"row spc-12 f-vert\">\r\n\t\t\t\t\t\t\t{publicPrivateMode==='public'?<SegmentControls value={+myComments}>\r\n\t\t\t\t\t\t\t\t<div className=\"super-center capitalize\" onClick={()=>setMyComments(false)}>All {sidebarMode}s</div>\r\n\t\t\t\t\t\t\t\t<div className=\"super-center capitalize\" onClick={()=>setMyComments(true)}>My {sidebarMode}s</div>\r\n\t\t\t\t\t\t\t</SegmentControls>:undefined}\r\n\t\t\t\t\t\t\t<input type=\"text\" placeholder=\" &#xf002;  Filter\"/> {/* TODO: Fix */}\r\n\t\t\t\t\t\t</div>:undefined}\r\n\t\t\t\t\t\t<div className=\"mx-auto pill my-8 px-10 py-2 h7\">{` ${sidebarMode}`}s above<i className=\"icon-chevron_up icon px-4\"/></div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</Scrollbar>\r\n\t\t\t<div className=\"mx-auto pill my-8 px-10 py-2 h7 bottom\">{` ${sidebarMode}`}s below<i className=\"icon-chevron_down icon px-4\"/></div>\r\n\t\t\t{sidebarMode==='note'?<Link className=\"add-note fa fa-plus button\"/>:undefined}\r\n\t\t</div>\r\n\t</div>\r\n}))\r\n\r\nexport const NewCommentBubble=withContext(BookContext,[\r\n\t'publicPrivateMode',\r\n\t'selection',\r\n\t'book',\r\n\t'setSelection',\r\n\t'setSidebarMode',\r\n\t'userId',\r\n\t'BookContextLocal',\r\n],memo(function NewCommentBubble({\r\n\tpublicPrivateMode,\r\n\tselection,\r\n\tbook,\r\n\tsetSelection,\r\n\tsetSidebarMode,\r\n\tuserId,\r\n\tBookContextLocal,\r\n}){\r\n\tconst [bubblePos,setBubblePos]=useState({})\r\n\tuseLifecycle({\r\n\t\tcomponentWillMount: ()=>BookContextLocal.setBubblePos=setBubblePos\r\n\t})\r\n\r\n\treturn <div className=\"new-bubble pos-abs f-end f-justify-center h7\" style={bubblePos}>\r\n\t\t{publicPrivateMode==='public'?<>\r\n\t\t\t<Link to={history.location.pathname+'/new-comment'} className=\"py-4 px-8 text-right\" onClick={()=>setSidebarMode('question')}>Question</Link>\r\n\t\t\t<Link to={history.location.pathname+'/new-comment'} className=\"py-4 px-8\" onClick={()=>setSidebarMode('comment')}>Comment</Link>\r\n\t\t</>:<>\r\n\t\t\t{/*<Link to={pathname+'/new-comment'} className=\"py-4 px-8 text-right\" onClick={()=>setSidebarMode('note')}>Note</Link>*/}\r\n\t\t\t<div className=\"py-4 px-8 text-center\" onClick={addHighlight}>Highlight</div>\r\n\t\t\t{/* eslint-disable-line jsx-a11y/anchor-is-valid */}\r\n\t\t</>}\r\n\t</div>\r\n\r\n\tfunction addHighlight(){\r\n\t\tsetSidebarMode('highlight')\r\n\t\tapi('post','comment',{\r\n\t\t\tbody: 'Highlight',\r\n\t\t\thashtags: '',\r\n\t\t\tselection_data: JSON.stringify([selection]),\r\n\t\t\tuser_id: userId,\r\n\t\t\tbook_id: book.id,\r\n\t\t\tcomment_type: 'highlight',\r\n\t\t}).then(({data})=>{\r\n\t\t\tdispatch(['SET_DATA',data])\r\n\t\t\tsetSelection(undefined)\r\n\t\t\tsetBubblePos({})\r\n\t\t})\r\n\t}\r\n}))\r\n\r\nexport function PageWiseComments({p,i}){\r\n\tconst ref=useRef()\r\n\tuseEffect(function componentDidUpdate(){\r\n\t\tref.current.style.setProperty('--height',ref.current.children[0].clientHeight+'px')\r\n\t})\r\n\r\n\treturn <div key={i} id={`page-${i}-comments`} className=\"PageWiseComments trim-y\" {...{ref}}>\r\n\t\t<div className=\"px-6 pb-12 f-vert\">\r\n\t\t\t<hr className=\"mb-8 mx-6\"/>\r\n\t\t\t<div className=\"px-6 h7 f-center pagewise-header\" {...{onClick}}>\r\n\t\t\t\t{/*<hr className=\"col\"/>*/}\r\n\t\t\t\t{/*<div className=\"px-8\">Page {+i+1}</div>*/}\r\n\t\t\t\t{/*<hr className=\"col\"/>*/}\r\n\t\t\t\t<h3>Page {+i+1}</h3>\r\n\t\t\t</div>\r\n\t\t\t{p.map(c=><div className=\"m-6\" key={c.id}>\r\n\t\t\t\t<Comment {...{commentId: c.id}}/>\r\n\t\t\t\t{/* TODO: Move <style> from comment to here */}\r\n\t\t\t</div>)}\r\n\t\t</div>\r\n\t</div>\r\n\r\n\tfunction onClick(){\r\n\t\t// TODO: Use gotoPage()\r\n\t\tdocument.querySelector(`.Page[data-page-index=\"${i}\"]`).scrollIntoView({behavior: 'smooth'})\r\n\t}\r\n}\r\n\r\nexport class Page extends MyComponent{\r\n\tstate={ loaded: false }\r\n\tsetLoaded=loaded=>this.setState({loaded})\r\n\r\n\tconstructor(props){\r\n\t\tsuper(props)\r\n\t\tprops.loaders[props.i]=this.setLoaded\r\n\t}\r\n\r\n\trender(){\r\n\t\t// logLifecycle && console.log('Page render')\r\n\t\tconst {page,viewport,i,pageComments}=this.props\r\n\t\treturn <div className=\"pos-rel f-super-center Page\" style={_.pick(viewport,['width','height'])} data-page-index={i}>\r\n\t\t\t{this.state.loaded?<>\r\n\t\t\t\t<PdfImage {...{page,viewport,className: 'card'}}/>\r\n\t\t\t\t<TextLayer {...{page,viewport,pageComments}}/>\r\n\t\t\t</>:undefined}\r\n\t\t</div>\r\n\t}\r\n}\r\n\r\nconst NewPublicComment=withContext(BookContext,[\r\n\t'sidebarMode',\r\n\t'selection',\r\n\t'setSelection',\r\n\t'book',\r\n\t'userId',\r\n],memo(function({\r\n\tsidebarMode,\r\n\tselection,\r\n\tsetSelection,\r\n\tbook,\r\n\tuserId,\r\n\tanimatedProps,\r\n}){\r\n\tconst ref=useRef()\r\n\tconst styleRef=useRef()\r\n\tconst local=useLocal({\r\n\t\tshowSpinner: false,\r\n\t\tactive: false,\r\n\t})\r\n\tuseLifecycle({componentDidMount})\r\n\tanimatedProps.componentWillExit=componentWillExit\r\n\r\n\treturn <div className={'NewPublicComment pos-abs stretch-to-fit'+(local.active?' active':'')} {...{ref}}>\r\n\t\t<style ref={styleRef}>{'.PageBook .RightSidebar{transform: translateX(100%)}'}</style>\r\n\t\t<div className=\"p-12\">\r\n\t\t\t<form className=\"col-12 row spc-12 card pos-rel\" style={{width: '480px'}} onSubmit={onSubmit}>\r\n\t\t\t\t<div className=\"close-btn\" onClick={history.goBack}/>\r\n\t\t\t\t<div className=\"capitalize\">New {sidebarMode}</div>\r\n\t\t\t\t<blockquote className=\"col-12 h7 text-muted mt-2 row\">\r\n\t\t\t\t\t<div className=\"trim col\">{selection?.text}</div>\r\n\t\t\t\t</blockquote>\r\n\t\t\t\t<textarea required className=\"col-12\" placeholder={sidebarMode} name=\"body\"/>\r\n\t\t\t\t<div className=\"col-12\"/>\r\n\t\t\t\t<div className=\"bottom-row col-12 col-ext row spc-12\">\r\n\t\t\t\t\t{/*<input className=\"col\" type=\"text\" placeholder=\"#Hashtag\" {...this.twoWayBind('hashtags')}/> TODO: Fix */}\r\n\t\t\t\t\t<div className=\"col\"/>\r\n\t\t\t\t\t<div className=\"button outline\" onClick={history.goBack}>Cancel</div>\r\n\t\t\t\t\t<button>Post</button>\r\n\t\t\t\t</div>\r\n\t\t\t</form>\r\n\t\t</div>\r\n\t\t<Spinner className={local.showSpinner?'active':''}/>\r\n\t</div>\r\n\r\n\tfunction componentDidMount(){\r\n\t\tlocal.active=true\r\n\t\tref.current.classList.add('active')\r\n\t}\r\n\tfunction componentWillExit(){\r\n\t\tlocal.active=false\r\n\t\tref.current.classList.remove('active')\r\n\t\tstyleRef.current.innerHTML=''\r\n\t}\r\n\tasync function onSubmit(e){\r\n\t\te.preventDefault()\r\n\t\ttry{\r\n\t\t\tsetSpinner(true)\r\n\t\t\tconst comment={\r\n\t\t\t\tbody: e.target.body.value,\r\n\t\t\t\tselection_data: JSON.stringify([selection]),\r\n\t\t\t\tuser_id: userId,\r\n\t\t\t\tbook_id: book.id,\r\n\t\t\t\tcomment_type: sidebarMode,\r\n\t\t\t}\r\n\t\t\tconsole.log(comment)\r\n\t\t\tconst {data}=await api('post','comment',comment)\r\n\t\t\tdispatch(['SET_DATA',data])\r\n\t\t\tsetSelection()\r\n\t\t\thistory.goBack()\r\n\t\t}finally{ setSpinner(false) }\r\n\t}\r\n\tfunction setSpinner(value){\r\n\t\tlocal.showSpinner=value\r\n\t\tconst spinnerEle=ref.current.querySelector('.spinner')\r\n\t\tvalue?\r\n\t\t\tspinnerEle.classList.add('active'):\r\n\t\t\tspinnerEle.classList.remove('active')\r\n\t}\r\n}))","import React,{Fragment} from 'react'\r\n// import _ from 'lodash'\r\n\r\nimport './SegmentControls.scss'\r\n\r\n// TODO: Focus\r\nexport default function SegmentControls({value,className,children,vertical,...props}){\r\n\tconst val=Number.isInteger(value)?value:-1\r\n\tconst sizeAttr=vertical?'height':'width'\r\n\treturn (\r\n\t\t<div {...props} className={'segment-controls row '+(className || '')}>\r\n\t\t\t<div\r\n\t\t\t\tclassName=\"highlight\"\r\n\t\t\t\tstyle={{\r\n\t\t\t\t\ttransform: vertical?`translateY(${val*100}%)`:`translateX(${val*100}%)`,\r\n\t\t\t\t\t[sizeAttr]: 100/children.length+'%',\r\n\t\t\t\t}}\r\n\t\t\t/>\r\n\t\t\t{children.map((c,i)=><Fragment key={i}>{c}</Fragment>)}\r\n\t\t</div>\r\n\t)\r\n}\r\n","export const isObject=o=>(!!o) && o.constructor===Object\r\nexport const isArray=a=>(!!a) && a.constructor===Array\r\n\r\nexport const getChildNodeIndex=element=>Array.from(element.parentNode.children).indexOf(element)\r\n\r\n// Warning: Will fail if whitespaces are present\r\nexport function getSelectionOffsetFromParent(node,parent,offset=0){\r\n\tconsole.warn('getSelectionOffsetFromParent: Will fail if whitespaces are present')\r\n\twhile(1){\r\n\t\tif(node===parent) return offset\r\n\t\tif(node.previousSibling){\r\n\t\t\tnode=node.previousSibling\r\n\t\t\toffset+=((node.innerText)?node.innerText.length:node.length)\r\n\t\t\tcontinue\r\n\t\t}\r\n\t\tnode=node.parentNode\r\n\t}\r\n}\r\n\r\nexport function binarySearchFindClosest(sortedArray,ele){\r\n\tconst getClosest=(val1,val2,ele)=>((ele-val1>=val2-ele)?val2:val1)\r\n\tconst n=sortedArray.length\r\n\r\n\t// Corner cases\r\n\tif(ele<=sortedArray[0]) return sortedArray[0]\r\n\tif(ele>=sortedArray[n-1]) return sortedArray[n-1]\r\n\r\n\t// Doing binary search\r\n\tlet low=0,high=n,mid=0\r\n\twhile(low<high){\r\n\t\tmid=(low+high)>>1\r\n\r\n\t\tif(sortedArray[mid]===ele) return sortedArray[mid]\r\n\r\n\t\t// If ele is less than mid element, search left portion\r\n\t\telse if(ele<sortedArray[mid]){\r\n\t\t\t// If ele is greater than previous to mid, return closest of two\r\n\t\t\tif(mid>0 && ele>sortedArray[mid-1]) return getClosest(sortedArray[mid-1],sortedArray[mid],ele)\r\n\t\t\t// Repeat for left half\r\n\t\t\thigh=mid\r\n\t\t}\r\n\r\n\t\t// If ele is greater than mid element, search right portion\r\n\t\telse{\r\n\t\t\t// If ele is lesser than next to mid, return closest of two\r\n\t\t\tif(mid<n-1 && ele<sortedArray[mid+1]) return getClosest(sortedArray[mid],sortedArray[mid+1],ele)\r\n\t\t\t// Repeat for right half\r\n\t\t\tlow=mid+1\r\n\t\t}\r\n\t}\r\n\r\n\t// Only single element left after search\r\n\treturn sortedArray[mid]\r\n}\r\n\r\nexport function binarySearchFindClosestIndex(sortedArray,ele){\r\n\tconst getClosestIndex=(i1,i2,ele)=>((ele-sortedArray[i1]>=sortedArray[i2]-ele)?i2:i1)\r\n\tconst n=sortedArray.length\r\n\r\n\t// Corner cases\r\n\tif(ele<=sortedArray[0]) return 0\r\n\tif(ele>=sortedArray[n-1]) return n-1\r\n\r\n\t// Doing binary search\r\n\tlet low=0,high=n,mid=0\r\n\twhile(low<high){\r\n\t\tmid=(low+high)>>1\r\n\r\n\t\tif(sortedArray[mid]===ele) return mid\r\n\r\n\t\t// If ele is less than mid element, search left portion\r\n\t\telse if(ele<sortedArray[mid]){\r\n\t\t\t// If ele is greater than previous to mid, return closest of two\r\n\t\t\tif(mid>0 && ele>sortedArray[mid-1]) return getClosestIndex(mid-1,mid,ele)\r\n\t\t\t// Repeat for left half\r\n\t\t\thigh=mid\r\n\t\t}\r\n\r\n\t\t// If ele is greater than mid element, search right portion\r\n\t\telse{\r\n\t\t\t// If ele is lesser than next to mid, return closest of two\r\n\t\t\tif(mid<n-1 && ele<sortedArray[mid+1]) return getClosestIndex(mid,mid+1,ele)\r\n\t\t\t// Repeat for right half\r\n\t\t\tlow=mid+1\r\n\t\t}\r\n\t}\r\n\r\n\t// Only single element left after search\r\n\treturn mid\r\n}\r\n\r\nexport const fileToBase64=async file=>\r\n\tawait new Promise((resolve,reject)=>{\r\n\t\tconst reader=new FileReader()\r\n\t\treader.readAsDataURL(file)\r\n\t\treader.onload=()=>resolve(reader.result)\r\n\t\treader.onerror=error=>reject(error)\r\n\t})","import {PureComponent} from 'react'\r\nimport _ from 'lodash'\r\n\r\nexport default class MyComponent extends PureComponent{\r\n\t// Used for simple 2-way binding\r\n\t// ex: <input {...this.twoWayBind('stateVariable')}/> will return\r\n\t//   <input value={this.state['stateVariable']} onChange={e=>this.setState({'stateVariable':e.target.value}}/>\r\n\t// ex: <input type=\"checkbox\" {...this.twoWayBind('stateVariable','onClick','checked')}/> will return\r\n\t//   <input type=\"checkbox\" checked={this.state['stateVariable']} onClick={e=>this.setState({'stateVariable':e.target.checked}}/>\r\n\ttwoWayBind=(property,event='onChange',valAttr='value')=>({\r\n\t\t[valAttr]:this.state[property],\r\n\t\t[event]:e=>this.setState({[property]:e.target[valAttr]}),\r\n\t})\r\n\r\n\t// Used for recording states where re-rendering is not needed\r\n\totherState={}\r\n\tsetOtherState=newOtherState=>_.forIn(newOtherState,(val,key)=>this.otherState[key]=val)\r\n}","// import _ from 'lodash'\r\n\r\nconst mode='stage'\r\nconst modes={\r\n\tdev: {\r\n\t\tmode: 'dev',\r\n\t\turl: 'http://localhost:23862/api/',\r\n\t},\r\n\tstage: {\r\n\t\tmode: 'stage',\r\n\t\turl: 'https://bbbook-gs.herokuapp.com/api/',\r\n\t},\r\n\tprod: {\r\n\t\tmode: 'prod',\r\n\t\turl: 'https://www.bbbook.ca/api/',\r\n\t},\r\n}\r\nexport const initState=JSON.stringify({\r\n\tuserId: null,\r\n\t// userId=null      indicates re-login hasn't finished\r\n\t// userId=undefined indicates after re-login, no user was found\r\n\t// TODO: handle logout case\r\n\r\n\tUSERS:    {},\r\n\tGROUPS:   {},\r\n\tBOOKS:    {},\r\n\tCOMMENTS: {},\r\n\r\n\tSELECTIONS: {},\r\n\r\n\tUI_DARKMODE: 'auto', // 'auto',true,false\r\n\r\n\tversion: '0.0.20 '+modes[mode].mode,\r\n\t...modes[mode]\r\n})\r\nexport let state=JSON.parse(initState)\r\n\r\n// Multi reducer pattern\r\n// + Multiple actions can be sent in one call and hence reducing need for multiple renders\r\n// + Ex: dispatch(['ACTION_1',data1],['ACTION_2',data2])\r\nexport default function mainReducer(oldState,...rest){\r\n\trest.forEach(([actionType,data])=>{\r\n\t\tconsole.log(actionType,data,state)\r\n\t\tstate={...oldState,...mainReducerInner(oldState,actionType,data)}\r\n\t\toldState=state\r\n\t})\r\n\tif(mode==='dev') window.state=state\r\n\treturn state\r\n}\r\n\r\n// Inner reducer pattern\r\n// + Can re-use actions within itself and hence reducing need for multiple renders\r\nfunction mainReducerInner(state,actionType,data){\r\n\tswitch(actionType){\r\n\t\tcase 'SET_STATE': return data\r\n\t\tcase 'SET_UI_DARKMODE': return {UI_DARKMODE: data}\r\n\t\tcase 'SET_DATA':\r\n\t\t\treturn {\r\n\t\t\t\tUSERS   : {...state.USERS   ,...genLibrary(data.users   )}, // eslint-disable-line no-whitespace-before-property\r\n\t\t\t\tGROUPS  : {...state.GROUPS  ,...genLibrary(data.groups  )}, // eslint-disable-line no-whitespace-before-property\r\n\t\t\t\tBOOKS   : {...state.BOOKS   ,...genLibrary(data.books   )}, // eslint-disable-line no-whitespace-before-property\r\n\t\t\t\tCOMMENTS: {...state.COMMENTS,...genLibrary(data.comments)}, // eslint-disable-line no-whitespace-before-property\r\n\r\n\t\t\t\tSELECTIONS: {...state.SELECTIONS,...parseSelections(data.comments)},\r\n\t\t\t}\r\n\t\tcase 'LOGIN':\r\n\t\t\treturn {\r\n\t\t\t\tuserId: data.userId,\r\n\t\t\t\t...mainReducerInner(state,'SET_DATA',data)\r\n\t\t\t}\r\n\t\tdefault: return {}\r\n\t}\r\n}\r\n\r\n// Creates a hashmap of objects keyed to their IDs\r\n// + Any object can be accessed via ID\r\nfunction genLibrary(data){\r\n\tif(!data || !data.length) return {}\r\n\tconst lib={}\r\n\tdata.forEach(d=>lib[d.id]=d)\r\n\treturn lib\r\n}\r\n\r\n// Library of comments.selection_data parsed\r\n// + Prevents parsing multiple times during different component renders\r\nfunction parseSelections(comments){\r\n\tif(!comments || !comments.length) return {}\r\n\tconst lib={}\r\n\t// TODO: Maybe generate only non hidden\r\n\tcomments.forEach(c=>{\r\n\t\tlib[c.id]=JSON.parse(c.selection_data || '[]')\r\n\t\tdelete c.selection_data\r\n\t})\r\n\treturn lib\r\n}\r\n","import React,{memo,useState} from 'react'\r\nimport * as pdfjs from 'pdfjs-dist'\r\nimport _ from 'lodash'\r\n\r\nimport Spinner from '../../utils/components/Spinner/Spinner'\r\nimport {state} from '../../reducers/mainReducer'\r\n\r\npdfjs.GlobalWorkerOptions.workerSrc=`//cdnjs.cloudflare.com/ajax/libs/pdf.js/${pdfjs.version}/pdf.worker.js`\r\n\r\nexport default pdfjs\r\n\r\nexport const PdfImage=memo(function({page,viewport,className}){\r\n\tconst [src,setSrc]=useState(undefined)\r\n\tif(!src){\r\n\t\tconst canvas=document.createElement('canvas')\r\n\t\tconst canvasContext=canvas.getContext('2d')\r\n\t\tcanvas.height=viewport.height\r\n\t\tcanvas.width=viewport.width\r\n\r\n\t\tpage.render({canvasContext,viewport}).promise.then(()=>setSrc(canvas.toDataURL()))\r\n\t\t// return <Spinner className=\"active\"/> // TODO: Delayed spinner\r\n\t}else\r\n\t\treturn <img alt=\"\" {...{className,src}}/>\r\n})\r\n\r\n// Memoize renderTextLayer\r\n// TODO: Check other hooks\r\nconst renderTextLayer=async (page,viewport)=>{\r\n\ttry{\r\n\t\tconst textContent=await page.getTextContent()\r\n\t\t// console.log(textContent)\r\n\t\t// const container=document.createElement('div')\r\n\t\tconst container=document.createElement('div')\r\n\t\tawait pdfjs.renderTextLayer({\r\n\t\t\ttextContent,\r\n\t\t\tcontainer,\r\n\t\t\tviewport,\r\n\t\t\ttextDivs: [],\r\n\t\t}).promise\r\n\t\treturn container\r\n\t}catch(e){ console.error(e) }\r\n}\r\n\r\nconst tagOpen=data=>`<mark-${data.id} id=\"a-${data.id}-${data.i}\" class=\"highlight\">`\r\nconst tagClose=data=>`</mark-${data.id}>`\r\nexport const TextLayer=memo(function({page,viewport,pageComments}){\r\n\tconst [__html,setHtml]=useState(undefined)\r\n\t renderTextLayer(page,viewport).then(textDiv=>{\r\n\t\tif(pageComments){ // If page has comments, introduce comment tags for lines (<span> elements)\r\n\r\n\t\t\t// Map highlights to line number (<span> index) as {commentId,selectionIndex,selectionOffset,isOpeningTag}\r\n\t\t\tconst lineData=[]\r\n\t\t\tpageComments.forEach(c=>{\r\n\t\t\t\t// OPTIMIZATION: state.SELECTIONS is imported without useContext to reduce renders. Only changes to props must result in renders.\r\n\t\t\t\t(state.SELECTIONS[c.id] || []).forEach((s,i)=>s.data.forEach(p=>{\r\n\t\t\t\t\tif(!lineData[p.startLine]) lineData[p.startLine]=[]\r\n\t\t\t\t\tlineData[p.startLine].push({id: c.id,i,offset: p.startOffset,start: true})\r\n\t\t\t\t\tif(!lineData[p.endLine]) lineData[p.endLine]=[]\r\n\t\t\t\t\tlineData[p.endLine].push({id: c.id,i,offset: p.endOffset,start: false})\r\n\t\t\t\t}))\r\n\t\t\t})\r\n\r\n\t\t\tconst openStack=[] // Tags opened will be added to this stack, popped as they are closed\r\n\t\t\tArray.from(textDiv.children).forEach((lineEle,lineNum)=>{ // For each span (line)\r\n\t\t\t\tconst l=lineData[lineNum]\r\n\t\t\t\tconst substrings=openStack.map(tagOpen) //\r\n\t\t\t\tif(l){ // If line has comments\r\n\t\t\t\t\tl.sort((a,b)=>a.offset-b.offset)\r\n\t\t\t\t\tl.forEach((data,i)=>{\r\n\t\t\t\t\t\tsubstrings.push(\r\n\t\t\t\t\t\t\t_.escape(lineEle.innerText.substring(\r\n\t\t\t\t\t\t\t\t(i===0)?0:l[i-1].offset,\r\n\t\t\t\t\t\t\t\tl[i].offset\r\n\t\t\t\t\t\t\t))\r\n\t\t\t\t\t\t)\r\n\t\t\t\t\t\tif(data.start){\r\n\t\t\t\t\t\t\tsubstrings.push(tagOpen(data))\r\n\t\t\t\t\t\t\topenStack.push(data)\r\n\t\t\t\t\t\t\t// console.log('push',[...openStack],data,lineNum)\r\n\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\t// console.log('splice',[...openStack],data,openStack.findIndex(d=>d.id===data.id),lineNum)\r\n\t\t\t\t\t\t\tsubstrings.push(openStack.map(tagClose).join(''))          // Close all open tags\r\n\t\t\t\t\t\t\topenStack.splice(openStack.findIndex(d=>d.id===data.id),1) // Remove closed tag from openStack\r\n\t\t\t\t\t\t\tsubstrings.push(openStack.map(tagOpen).join(''))           // Open all open tags again\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t\tsubstrings.push(\r\n\t\t\t\t\t\t_.escape(lineEle.innerText.substring(\r\n\t\t\t\t\t\t\t(l.pop()).offset,\r\n\t\t\t\t\t\t\tlineEle.innerText.length\r\n\t\t\t\t\t\t))\r\n\t\t\t\t\t)\r\n\t\t\t\t\tsubstrings.push(openStack.map(tagClose).join(''))\r\n\t\t\t\t\t// console.log(substrings,substrings.join(''),[...openStack],lineNum)\r\n\t\t\t\t}else substrings.push(lineEle.innerHTML)\r\n\t\t\t\tlineEle.innerHTML=substrings.join('')\r\n\t\t\t\t// console.log(lineEle.innerHTML)\r\n\t\t\t})\r\n\t\t}\r\n\t\tsetHtml(textDiv.innerHTML)\r\n\t})\r\n\treturn (!__html)? // If page not yet rendered\r\n\t\t// <Spinner className=\"active\"/>: // TODO: Delayed spinner\r\n\t\t<></>:\r\n\t\t<div className=\"text-layer pos-abs stretch-to-fit\" dangerouslySetInnerHTML={{__html}}/>\r\n})\r\n","import React,{useState,memo} from 'react'\r\nimport {Link} from 'react-router-dom'\r\n\r\nimport './Comment.scss'\r\nimport {MainContext,api,dispatch,history} from '../../contexts/MainContext'\r\nimport {setAlert} from '../../utils/components/Alert/Alert'\r\nimport {withContext} from '../../utils/hocs'\r\n\r\nconst whitespaceRegex=/\\s+/\r\n\r\n// TODO: CommentBody\r\n// TODO: Right-click\r\nconst Comment=withContext(MainContext,[\r\n\t'COMMENTS',\r\n\t'USERS',\r\n\t'userId',\r\n\t'SELECTIONS',\r\n],memo(function({\r\n\tchildren,\r\n\tcommentId,\r\n\tshowChildren=false,\r\n\r\n\tCOMMENTS,\r\n\tUSERS,\r\n\tuserId,\r\n\tSELECTIONS,\r\n}){\r\n\tconst [editMode,setEditMode]=useState()\r\n\r\n\tconst comment=COMMENTS[commentId]\r\n\tconst user=USERS[comment?.user_id]\r\n\r\n\tlet commentBody\r\n\r\n\tif(comment){\r\n\t\tconst selection=SELECTIONS[commentId] || []\r\n\t\tcommentBody=<>\r\n\t\t\t{/* TODO: remove onClick workaround after node.js backend */}\r\n\t\t\t{selection.map((s,i)=><blockquote\r\n\t\t\t\tkey={i}\r\n\t\t\t\tclassName=\"h7 text-muted mt-2 row cur-p\"\r\n\t\t\t\tonClick={()=>document.getElementById(`a-${commentId}-0`)?.scrollIntoView({behavior: 'smooth'})}>\r\n\t\t\t\t<div className=\"trim col\">{s?.text}</div>\r\n\t\t\t</blockquote>)}\r\n\t\t\t{/*userId+''===comment.user_id+''?<div className=\"h7 b-700\" style={{marginBottom: '-21px !important'}}>\r\n\t\t\t\t<i className=\"fa fa-plus\"/> Add Highlight\r\n\t\t\t</div>:undefined*/}\r\n\t\t\t<div className=\"h8 my-2 text-right\">{(new Date(comment.created_at)).toLocaleString()}</div> {/* TODO: Beautify */}\r\n\t\t\t<div className=\"bottom-row col-ext-x col-ext-b row spc-8 spc-x-12 f-center\">\r\n\t\t\t\t{/*<i className=\"icon icon-arrow_big_up\" onClick={like}/><div className=\"h7 ml-0\">{comment.liked.length}</div>\r\n\t\t\t\t<i className=\"icon icon-arrow_big_down text-muted\"/><div className=\"h7 ml-0\">{comment.disliked.length}</div>*/}\r\n\t\t\t\t{/*<i className=\"fa fa-star text-muted h6\"/>*/}\r\n\t\t\t\t<div className=\"col\"/>\r\n\t\t\t\t<i className=\"icon icon-reply h6\"/><div className=\"h7 ml-0\">{comment.reply_ids.length}</div>\r\n\t\t\t\t<Link className=\"button super-center\" to={history.location?.pathname+'/thread/'+commentId}>Open Thread</Link>\r\n\t\t\t\t{userId+''===comment.user_id+''?<>\r\n\t\t\t\t\t{editMode?<div className=\"edit-form-open pos-abs stretch-to-fit\" onClick={()=>setEditMode(false)}/>:undefined}\r\n\t\t\t\t\t<div className=\"px-12 py-8 col-ext pos-rel f-self-stretch f-center cur-p\" onClick={()=>setEditMode(true)}>\r\n\t\t\t\t\t\t<i className=\"fa fa-ellipsis-v\"/>\r\n\t\t\t\t\t\t<div className={'edit-form pos-abs card trim'+(editMode?' active':' ')}>\r\n\t\t\t\t\t\t\t<div className=\"px-12 py-8 f-center\" onClick={deleteComment}><i className=\"icon-cross_mark mr-8\"/>Delete</div>\r\n\t\t\t\t\t\t\t{/*<div className=\"px-12 py-8\">Edit</div>*/}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</>:undefined}\r\n\t\t\t</div>\r\n\t\t</>\r\n\t\treturn (\r\n\t\t\t<>\r\n\t\t\t\t<style>{`\r\n\t\t\t\t\tmark-${commentId}.highlight.highlight{\r\n\t\t\t\t\t\t--alpha: 1;\r\n\t\t\t\t\t\tcursor: pointer;\r\n\t\t\t\t\t}\r\n\t\t\t\t`}</style>\r\n\t\t\t\t<div className=\"Comment\">\r\n\t\t\t\t\t<div id={`b-${commentId}`} className=\"id-tag\"/>\r\n\t\t\t\t\t<div className=\"row pb-4 top-row\">\r\n\t\t\t\t\t\t{comment.hidden?undefined:<>\r\n\t\t\t\t\t\t\t{/* TODO: Fix */}\r\n\t\t\t\t\t\t\t{/*<div className=\"h7 hashtag\">{comment.hashtags.split(whitespaceRegex).map((h,i)=><span key={i} className=\"mr-4\">#{h}</span>)}</div>*/}\r\n\t\t\t\t\t\t</>}\r\n\t\t\t\t\t\t<div className=\"col\"/>\r\n\t\t\t\t\t\t<div className=\"h7 text-muted\">@{user.username}</div>\r\n\t\t\t\t\t\t<img className=\"pos-rel\" src={require('../../assets/imgs/default-profile-icon.jpg')} alt=\"User icon\"/>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div className=\"card row f-vert spc-12\">\r\n\t\t\t\t\t\t<div className=\"comment-body o ne-line\">{comment.hidden?'[Deleted]':comment.body}</div>\r\n\t\t\t\t\t\t{comment.hidden?undefined:commentBody}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t{showChildren && (children || !!comment?.reply_ids.length) &&\r\n\t\t\t\t<div className=\"reply col-ext row spc-12\">\r\n\t\t\t\t\t<div className=\"col col-ext-x col-ext-t row spc-12 f-vert\">\r\n\t\t\t\t\t\t{comment?.reply_ids.map(c=><Comment key={c} {...{commentId: c,showChildren}}/>)}\r\n\t\t\t\t\t\t{children}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t}\r\n\t\t\t</>\r\n\t\t)\r\n\t}else return null\r\n\r\n\tfunction like(){\r\n\t\tapi('put','like/'+commentId).then(({data})=>{\r\n\t\t\tconsole.log(data)\r\n\t\t})\r\n\t}\r\n\r\n\tfunction deleteComment(){\r\n\t\t// TODO: Use commentBody\r\n\t\tsetAlert(\r\n\t\t\t<div className=\"row spc-12\" style={{maxWidth: '320px'}}>\r\n\t\t\t\t<div className=\"col-12\">Do you want to delete this comment?</div>\r\n\t\t\t\t<div className=\"Comment card col-12 row f-vert spc-12\">\r\n\t\t\t\t\t<div className=\"o ne-line\">{comment.body}</div>\r\n\t\t\t\t\t<blockquote className=\"h7 text-muted mt-2 row\">\r\n\t\t\t\t\t\t{SELECTIONS[commentId]?.map((s,i)=><div key={i} className=\"trim col\">{s?.text}</div>)}\r\n\t\t\t\t\t</blockquote>\r\n\t\t\t\t\t<div className=\"h8 my-2 text-right\">{(new Date(comment.created_at)).toLocaleString()}</div> {/* TODO: Beautify */}\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"bottom-row col-ext-x col-ext-b col-12 row spc-x-12 spc-y-8 f-justify-end\">\r\n\t\t\t\t\t<button className=\"outline\" onClick={()=>setAlert()}>Cancel</button>\r\n\t\t\t\t\t<button onClick={()=>{\r\n\t\t\t\t\t\tapi('delete','comment',{comment_id: commentId}).then(({data})=>{\r\n\t\t\t\t\t\t\tsetAlert()\r\n\t\t\t\t\t\t\tdispatch(['SET_DATA',data])\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}}>OK</button>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t)\r\n\t}\r\n}))\r\n\r\nexport default Comment\r\n","import React,{memo} from 'react'\r\n\r\nimport './Header.scss'\r\nimport {MainContext} from '../../contexts/MainContext'\r\nimport {withContext} from '../../utils/hocs'\r\n\r\nexport default withContext(MainContext,[\r\n\t'version',\r\n],memo(function Header({\r\n\tchildren,\r\n\r\n\tversion,\r\n}){\r\n\treturn (\r\n\t\t<header className=\"Header row spc-x-8 f-center pos-sty f-order-m1\">\r\n\t\t\t<h3 className=\"logo small-caps f-center ml-12\">\r\n\t\t\t\t<span className=\"b-800\">BB</span>B<span className=\"b-600\">ook</span>\r\n\t\t\t\t<sup className=\"h7 normal-caps ml-4\" style={{height: 'auto'}}>Pre-Alpha <b className=\"b-900\">{version}</b></sup>\r\n\t\t\t</h3>\r\n\t\t\t{children}\r\n\t\t\t{/*<SegmentControls className=\"ml-16\" value={1}>*/}\r\n\t\t\t{/*\t<div className=\"super-center px-16\">Discover</div>*/}\r\n\t\t\t{/*\t<div className=\"super-center px-16 active\">PageDashboard</div>*/}\r\n\t\t\t{/*</SegmentControls>*/}\r\n\t\t\t{/*<div className=\"col\"/>*/}\r\n\t\t\t{/*<input className=\"col mx-8\" type=\"search\"/>*/}\r\n\t\t\t{/*<button className=\"new-group-button mr-16 f-center\">New Group</button>*/}\r\n\t\t\t{/*<div className=\"text-right\">*/}\r\n\t\t\t{/*\tFirstname Lastname*/}\r\n\t\t\t{/*\t<div className=\"h7 text-muted\">@Username</div>*/}\r\n\t\t\t{/*</div>*/}\r\n\t\t\t{/*<img*/}\r\n\t\t\t{/*\tclassName=\"profile-icon\"*/}\r\n\t\t\t{/*\tsrc={require('../../assets/imgs/default-profile-icon.jpg')}*/}\r\n\t\t\t{/*\talt=\"default-profile-icon\"*/}\r\n\t\t\t{/*\tonClick={()=>dispatch(['SET_UI_SIDEMENU',!state.UI_SIDEMENU])}/>*/}\r\n\t\t</header>\r\n\t)\r\n}))\r\n","module.exports = \"data:image/jpeg;base64,/9j/4AAQSkZJRgABAgAAZABkAAD/7AARRHVja3kAAQAEAAAAZAAA/+4ADkFkb2JlAGTAAAAAAf/bAIQAAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQICAgICAgICAgICAwMDAwMDAwMDAwEBAQEBAQECAQECAgIBAgIDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMD/8AAEQgAwADAAwERAAIRAQMRAf/EAH8AAQEAAgMBAQEAAAAAAAAAAAAGBAgHCQoFCwIBAQAAAAAAAAAAAAAAAAAAAAAQAAEBBQQJAgUCBgAFBQAAAAECAKEDBAVh0RITESExQeEiUgYH8FFxgZEjCDIUscHxYqIJQnIzFRckFiYYChEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEQMRAD8A9+eM2PvYGM2PvYGM2PvYGM2PvYGM2PvYGM2PvYGM2PvYGM2PvYGM2PvYGM2PvYGM2PvYGM2PvYGM2PvYGM2PvYGM2PvYGM2PvYGM2PvYGM2PvYGM2PvYGM2PvYGM2PvYGM2PvYGM2PvYGM2PvYMHGLXXsDGLXXsDGLXXsDGLXXsDGLXXsDGLXXsDGLXXsDGLXXsDGLXXsDGLXXsDGLXXsDGLXXsDGLXXsDGLXXsDGLXXsDGLXXsDGLXXsDGLXXsDGLXXsDGLXXsDGLXXsDGLXXsDGLXXsDGLXXsGHmHqDmBmHqDmBmHqDmBmHqDmBmHqDmBmHqDmBmHqDmBmHqDmBmHqDmBmHqDmBmHqDmBmHqDmBmHqDmBmHqDmBmHqDmBmHqDmBmHqDmBmHqDmBmHqDmBmHqDmBmHqDmBmHqDmBmHqDmBmHqDmDCzLH8GBmWP4MDMsfwYGZY/gwMyx/BgZlj+DAzLH8GBmWP4MDMsfwYGZY/gwMyx/BgZlj+DAzLH8GBmWP4MDMsfwYGZY/gwMyx/BgZlj+DAzLH8GBmWP4MDMsfwYGZY/gwMyx/BgZlj+DBhZg6i9gZg6i9gZg6i9gZg6i9gZg6i9gZg6i9gZg6i9gZg6i9gZg6i9gZg6i9gZg6i9gZg6i9gZg6i9gZg6i9gZg6i9gZg6i9gZg6i9gZg6i9gZg6i9gZg6i9gZg6i9gZg6i9gZg6i9gZg6i9gxMyx/BgZlj+DAzLH8GBmWP4MDMsfwYGZY/gwMyx/BgZlj+DAzLH8GBmWP4MDMsfwYGZY/gwMyx/BgZlj+DAzLH8GBmWP4MDMsfwYGZY/gwMyx/BgZlj+DAzLH8GBmWP4MDMsfwYGZY/gwYGMWuvYGMWuvYGMWuvYGMWuvYGMWuvYGMWuvYGMWuvYGMWuvYGMWuvYGMWuvYGMWuvYGMWuvYGMWuvYGMWuvYGMWuvYGMWuvYGMWuvYGMWuvYGMWuvYGMWuvYGMWuvYGMWuvYGMWuvYGMWuvYMTNtT6+bAzbU+vmwM21Pr5sDNtT6+bAzbU+vmwM21Pr5sDNtT6+bAzbU+vmwM21Pr5sDNtT6+bAzbU+vmwM21Pr5sDNtT6+bAzbU+vmwM21Pr5sDNtT6+bAzbU+vmwM21Pr5sDNtT6+bAzbU+vmwM21Pr5sDNtT6+bAzbU+vmwM21Pr5sGDmWP4MDMsfwYGZY/gwMyx/BgZlj+DAzLH8GBmWP4MDMsfwYGZY/gwfyqMlI0q1D48GD5kzVUQwQm3Xp1/K0FglZ6tbdKtf/M/4MEpNV1aFFSIi0KB1FKylQ+Y0fJgxIHkSpU5YxrTPQQeaFMnSsgbcMcDMC/+bELGDk/t3vCkdyw1fsouCbhJCpiRjKSmYhDSEmIkDVGgYjoxp2aQFBJOhgpsyx/BgZlj+DAzLH8GBmWP4MDMsfwYGZY/gwMyx/BgZlj+DAzLH8GDEzD1BzAzD1BzAzD1BzAzD1BzAzD1BzAzD1BzAzD1BzAzD1BzBjzE4iWhla1jSdSRq1n5DYGCTna1t+5v93fL6MElO1rb9333vYJGdrX6vubvf0dbBJTta/V9zfs0uYJGdrW37u873/Jgn4fdk7SZ2BUadOLlZuViCLBiw1aNBG1Kk/piQoo5VoVpStJIIIJYNz/Hvfkn33QUVKCqFBn5ZYlKtJIUD+2nEpCscMK0r/azSOeGTp0DSkkqSpgu8w9QcwMw9QcwMw9QcwMw9QcwMw9QcwMw9QcwMw9QcwMw9QcwYOM2PvYGM2PvYGM2PvYGM2PvYGM2PvYGM2PvYGM2PvYGM2PvYOPO4a5/6uLBSRhlyYOonWtP/U02her5MEBO1o6+Yfz1fPaGCSna0dfMPW/4FgkZ2tHXrG/e7bvYJKdrR18w37+O0MEjO1o8xxD1vYJKdrR18w2+537tuwsHI3gbyCqgeR6ZTo0UJp/dJFBmUKUcP7yYVipMUJ06FRhUMMFOnYiOrR7MHY/jNj72BjNj72BjNj72BjNj72BjNj72BjNj72BjNj72BjNj72DDzB1F7AzB1F7AzB1F7AzB1F7AzB1F7AzB1F7AzB1F7AzB1F7Bq9Ua7mxIsRSziiRFrVrJ1rUVK0n31sEdO1oa+c7D7+tOlgkp2tDm+4X6P6MElO1oa+c7TvLBIztaGvnO/fuvYJGdrQ185+voaGCSna0NJ5ztO87fWxgnoXdEWl1GRqcvEUJinTstPS5CilQjSkdEeGQoA4VBcMa2DvWzB1F7AzB1F7AzB1F7AzB1F7AzB1F7AzB1F7AzB1F7AzB1F7Bh4zY+9gYzY+9gYzY+9gYzY+9gYzY+9gYzY+9gYzY+9gYzY+9g0Tq1SiyszNSsVWiLLR4sCIDqIXBiKhrBB1ghSWCLna0dZxjewSM7Wjr5xsPt8fowSU7Wjzc4d9PiwSM7Wjzc42n1oYJGdrR18437/Wpgkp2tHQrnGz3YPhSseZrVWptHlCVTVWqMlTZVKUlalTE9MwpWAlKQQVKMWKBo06SweiHGbH3sDGbH3sDGbH3sDGbH3sDGbH3sDGbH3sDGbH3sDGbH3sGDjFrr2BjFrr2BjFrr2BjFrr2BjFrr2BjFrr2BjFrr2BjFrr2DRfzlIRO3O8ZuYCFJka8k1WVXo0IMZZCajDxA6DFROaYhG5MVPvpYNeZ2tDXzH+X8dhYJGdrQ5uY7xr0fTTpYJGdrQ18xdp/jtDBJTtaGvmLvrt2Fgkp2tDXzH6j6bdhYJGdrQ5uY/XX/AB2hg2O/DTsqP5D820epxYKolD7ACe7anGUgmH+/llmH25LJX+lE1ErBRMJB/VDlImjQRpAd4mMWuvYGMWuvYGMWuvYGMWuvYGMWuvYGMWuvYGMWuvYGMWuvYMPMPUHMDMPUHMDMPUHMDMPUHMDMPUHMDMPUHMDMPUHMDMPUHMHHPlHsOW8idrzFIMaFK1WXKpuiVBY5ZWfSgpEOMUAxP2c4j7cUAK0AhYSVISGDqe7rh1ftirT9CrsrHp1Up0ZUCalY6SlSSDyRIav0x5aYRoXDiIKkREKCkkpILBx1O1rb9zf7u+X0YJKdrW37vvvewSM7Wv1fd3e+r3+Otgkp2tfq+5v2aXMGN25Se5O/e5KV2j2jTZut1+tzaJSQkJNBWta1n7kxHXqhyslKQwYkePFKYUCElS1qSlJID0B/jp4Tpvgnx7J9tQ40vP8AcdRWiq931qCk4ajWokJKDLyqoqUxv+1UqEMiWSoIxAKilCYkVYYOesw9QcwMw9QcwMw9QcwMw9QcwMw9QcwMw9QcwMw9QcwMw9QcwYWZY/gwMyx/BgZlj+DAzLH8GBmWP4MDMsfwYGZY/gwMyx/BgZlj+DBxJ5V8Odn+WqcmBXJeJI1mVgrh0vuOniGipyQJK0wYuJOXUJDMJJgRdIGJRhqhrVjYOsfyX+LHmXs2JMR6VRVd9UdONUOf7VC5qoZaT9tMx2+rRVhMqTrKZdEzDGzMJ0MGnncCqvRZhcpWaZUaTNpKgqWqcnMyEwlSCArTBm4UKICkkBQI1MEpLCtV6aEjQ6TU6zOqKUplKTIzVQmlKWSEpTLykGNFUVkHRq1lg2P8cfhT578jzECNVqF/44oEQw1Rqr3mFydSylH7iZXtiHpra5uGkghMyiThKOrNB06A7c/BX45+O/AdJXA7Zk11PuSfgJhVzvKrIgxK5UhiREXKwFIQIdKpGchKkysDQk4EGKqLESIjBz/mWP4MDMsfwYGZY/gwMyx/BgZlj+DAzLH8GBmWP4MDMsfwYGZY/gwYWYOovYGYOovYGYOovYGYOovYGYOovYGYOovYGYOovYGYOovYOAPKP5N+KPFJjyVXrprPcEEKSe2+3RDqNShRRqy6hFzYUhSyFEYkx4yIuHWlCtjBoD5A/wBgPkWqqjS/ZFKo3ZckSoQZyPCT3FXAASErMWfhIo8PEnQSgyUTCf8AjIYNQO7fyD8s90LiqrnknvGchxdKlyiK7PyVO06QdKKZIRpWnQyFAfphAamDgqqdxx5qKuNMzceYikAKix4sSNEIAwp0xIilKICRo1nUGCSi9xzEpFEeVm48tHTiSiNAjRIMVIUnCoJiQ1JWnEDo262CtoP5Oeb+yYsOJ2z5a77p0OCSqHJL7jqM/StOIq0ro9SjTlKinSonQuCrTpLBtV46/wBrvl7taLLyvknt/t3yRTElAmZ6WhI7Q7mKSoBcVMzS5eL29FwI0kQxToWJWrMSDpAdo3gn86fx88+Rpaj9v91ntfvOYMOGjsnvb9vRK1NzCwn7VFmP3MekV9Sl4sEOVmIkzgTiXBQGDcHMHUXsDMHUXsDMHUXsDMHUXsDMHUXsDMHUXsDMHUXsDMHUXsGHjNj72BjNj72BjNj72BjNj72BjNj72BjNj72D4ncfdFD7Ros/3F3LVJOjUWmQVR52oTsQogwkDUlKUpxRY8eKohMOFDSuLFWQlCVKIBDqa88/mr3N3jFnO3fHMeb7S7TBiQItUhLMDuWuwtJBiLmYaiujSMUAaIUBQjKTpzIhSowkhoJPVtalLUpeJSiSoqJKionScRJ0kk72CQna0dfMH6f47QwSM7Wjr5g/66NLBJTtaVr5hv8A6bdhYJGdrR18w3/027QwSU7Wjzcw9b9Gn6sEjO1o6+YfU6P47CwSk3XIkNQWiIULQoKQtKlJUlaTiSUqBBStJGkEMHZ3+JH+2HyB4gnaZ2T52mKp5N8YlUCTgdwRohnO/uzZfGlCY8CfjrEXuykS6VHHKzi1TaE6MiYCIaZdYek3sHyJ2Z5S7Ronfnj3uSld29o9xSiJ2kVykRzGlZmErUuFEQsQ5iSnpWKDDmJaOiFMS0ZKocVCIiVJAWOM2PvYGM2PvYGM2PvYGM2PvYGM2PvYGM2PvYMHGLXXsDGLXXsDGLXXsDGLXXsDGLXXsHwu5u6KF2dQKr3P3JUINLolFk4k7UJ6YUBDhQUaEpSlI0rjTEeKpMOFDQCuLFWlCAVKAIdFv5FfktXfNHcMXBEm6X2PTJhR7b7bVEQMGFBgmrVYQSUTVXmUlR1laJZCzChk864gaoTtaHNzH6jRs+OwsElO1oa+Y797viwSM7Whr5js9/lp92CRna0ObmP11fx2Fgkp2tfq5jv3u06WCRna1t5js9/56doYJKdrQ18x+o+vwYJGdrQ18x+Gl1ulgkp2tDXzHfv33hgkZ2tDm5j9X6GDcn8Hv9gvfP4b+QIBiRql3L4Y7jqUJfkTx7DiwFmKFQf2g7o7WM4RCpvdNNhhCtCVwoNSgwky8woaIMaXD2c+N/JPZXlzsXtfyV48r0n3N2X3jSYFZoFakFhcGalIxVDiQoqDoiyk/IzUKJLzUtFCI8rMwokGKlMRCkgLbGLXXsDGLXXsDGLXXsDGLXXsDGLXXsGHmHqDmBmHqDmBmHqDmBmHqDmBmHqDmDpW/OL8kIne3dsx4y7ZqH/w7sueXBq0aWi/a7g7pliqFNxFqSQmLIUKIVS8FOjCqOIsTStJhFIddM7Wjr+4Pqnad/wLBJTtaOv7g37x8x8GCRna0eb7g+o0/wBQwSM7WjzHMHx0j6/Ngkp2tHX9wb942+3wLBIztaOv7gdrA3fEMElO1o6/uD32j5HQwSU7WjzfcG0jaNGm4sEjO1o6/uDXp3j6fJgkZ2tHX90e+0bPf4hgkp2tHSfuDb7jbcWCRna0df3Bv1aR8wwdzv8Apm/2CzHhDy7I/jZ5Irh/8QeZK5Bku15yoTCv23YPk+oGHK0mPBWtSkStC73mBDp84jDghzy5WZKoUNM0qIHsXzD1BzAzD1BzAzD1BzAzD1BzAzD1BzBh4xa69gYxa69gYxa69gYxa69g1k/LjzOPC3hiv1yQj5Pc/cCh2p2oUrSiNAqtVl5gxqpD5sYNGpsCPMIVhUnPRDSrUtg83c/XCtS1qWpSlEqUpR0qUokkqJJJKtO33YJCdrQ18x+o0bPjsLBIztaGvWd+8fRgkZ2tDXzH6v8AiGCSna0NfM9+3YWCSna0Nes7xtdawSM7Whr1n669VzBIztaGvmLh82CSna0Nes794+m3ewSM7Whr5jsO93xDBJTtaHMcR+r9DBIztaGvmO339/nsLBIztaGvWd+93xDBKzNdVCWmJDirhxIakxIcSGspWhaFBSYiFpIUlaFAEEa9LB+gT/qj/L7/AO4v4d9id512oie8l9hLX4t8qKXFEScm+6e1pOS/ZdyTIUREXE7w7bm5KoxYgSmF+8jzEJGnKOgOyXGLXXsDGLXXsDGLXXsDGLXXsGFj/u/y4sDH/d/lxYGP+7/LiwMf93+XFg6Hv9nXllVY8u0PxvKzZMh497egTM/LhagB3H3ZDgVWOYiArAvKoEOnmGSNKc1ejUpg6sJ2tbfu++9/wYJKdrW37j3fNgkZ2tbRmH6+tYYJKdrW37vvvewSM7WtR+777z7/AM2CSna1tGY93xDBIzta2/d3ne9gkZ2tbfu++/1qLBJTta2/cPttd8WCRna1t+6dvu8btTBJTta2/d995+vwLBIzta2/c3bNJ+jBJTta/V9x/oamCRna1t+7773/AAYPQL/+cH8mYvZP5cd7/jxU6ktNA/IDsCeqFDkVRllKvIfiyBPdzyRl4Kl5UL9x2HGr6o6kjHEMtBB0hA0B7e8f93+XFgY/7v8ALiwMf93+XFgY/wC7/LiwYeZY/gwMyx/BgZlj+DAzLH8GDyLfkz5Eid6+efL/AHKqOY0Gf8g9zw5CIoq0/wDaKbVJil0VHMEqBg0mSgo1gfp2bmDWmdrW3WN+/Vr0uLBJTtaOvX7ja5gkZ2tHXrfr/qGCSna1t5vfe8WFgkZ2tbdY379/t8GCSna1+rW/Xb8wwSM7Wtuu3a9gkp2tHXr997vgWCRna1t17vf+XuGCSna1+rW997BIzta283vv1f0LBIzta1HW/f7H+TBJTta263v+LBJTta26xv36telxYNlfwE81R/DP5x/ih5Ihza5KVoHnnxtL1yOgrx/+1e4O5pDtrvCAMtC1n912rWJyFoCVEhejQdjB+pzmWP4MDMsfwYGZY/gwMyx/BgwcafdxuYGNPu43MDGn3cbmBjT7uNzB4Z6v3HFnZqanJiLimJuPGmo6gkICo0eKqLEUEJ0JSFLWToA0Bgip2tDXzn1u+DBIztaGvnO0+viwSU7Whr5zv9aGCRna0OY43+tTBIztaGvnO339bGCSna0NfOd92n4sEjO1oc3Of5fx2Fgkp2tDm5zt9a7GCRna0NfOden18WCSna0NfOdnr5H6MEjO1ocwxn6u+DBJTtaGvnO/e/4sEjO1oc3Od/rQwSM7Whzc54+23YwfAgd1zNHqdPq8hGEKepU/K1GSiqQmKmHNyMeHNS8RUKIFQ4gRGhJOhQIVo0HUwfse40+7jcwMafdxuYGNPu43MDGn3cbmD//Z\"","import React,{memo} from 'react'\r\nimport {NavLink,withRouter} from 'react-router-dom'\r\n\r\nimport './Sidemenu.scss'\r\nimport {MainContext,logout} from '../../contexts/MainContext'\r\nimport SegmentControls from '../../utils/components/SegmentControls/SegmentControls'\r\nimport {withContext} from '../../utils/hocs'\r\n\r\nconst urlToValue={\r\n\thome: 0,\r\n\tnotifications: 1,\r\n\tgroups: 2,\r\n\tlibrary: 3,\r\n\trecents: 4,\r\n}\r\n\r\n// TODO: Icons mode\r\n// TODO: withRouter\r\n// MAYBE: Hover segment controls\r\nexport default withContext(MainContext,[\r\n\t'USERS',\r\n\t'userId',\r\n\t'version',\r\n],withRouter(memo(function({\r\n\tlocation,\r\n\r\n\tUSERS,\r\n\tuserId,\r\n\tversion,\r\n}){\r\n\tconst user=USERS[userId]\r\n\tconst segValue=urlToValue[location.pathname.split('/')[1]] ?? -1\r\n\treturn <section id=\"Sidemenu\" className=\"f-vert pos-abs stretch-to-fit\">\r\n\t\t<div className=\"py-24 text-center\">\r\n\t\t\t<h5 style={{color: 'white',fontWeight: '300'}}><b>BB</b>Book <sup className=\"h7\">Pre-Alpha</sup></h5>\r\n\t\t\t<div className=\"h8\">v{version}</div>\r\n\t\t</div>\r\n\t\t<div className=\"px-12\">\r\n\t\t\t<SegmentControls\r\n\t\t\t\tclassName={'f-vert val-'+segValue}\r\n\t\t\t\tvalue={segValue}\r\n\t\t\t\tvertical={true}>\r\n\t\t\t\t<NavLink className=\"p-12\" to=\"/home\">Home</NavLink>\r\n\t\t\t\t<NavLink className=\"p-12\" to=\"/notifications\">Notifications</NavLink>\r\n\t\t\t\t<NavLink className=\"p-12\" to=\"/groups\">Groups</NavLink>\r\n\t\t\t\t<NavLink className=\"p-12\" to=\"/library\">Library</NavLink>\r\n\t\t\t\t<NavLink className=\"p-12\" to=\"/recents\">Recents</NavLink>\r\n\t\t\t</SegmentControls>\r\n\t\t</div>\r\n\t\t<div className=\"col\"/>\r\n\t\t<NavLink to={'/user|'+userId} className=\"user-card card m-12 p-12 row\">\r\n\t\t\t<div style={{width: 'calc(100% - 56px)'}}>\r\n\t\t\t\t<div className=\"h7 text-muted\">@{user?user.username:'@Username'}</div>\r\n\t\t\t\t<div className=\"one-line col-12 pb-24\">\r\n\t\t\t\t\t{user?user.first_name:'Firstname'} {user?user.last_name:'Lastname'}\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"h7 text-muted heading\">{user?user.email:'user@email.com'}</div>\r\n\t\t\t</div>\r\n\t\t\t<img className=\"profile-icon f-self-start ml-12\" src={require('../../assets/imgs/default-profile-icon.jpg')} alt=\"default-profile-icon\"/>\r\n\t\t</NavLink>\r\n\t\t<div className=\"bottom-row row spc-12 super-center h7\">\r\n\t\t\t<div onClick={logout}>Log out</div>\r\n\t\t\t<span className=\"text-muted\">|</span>\r\n\t\t\t<div>Switch User</div>\r\n\t\t</div>\r\n\t</section>\r\n})))\r\n","import React,{memo} from 'react'\r\n\r\nimport './BookThumbnail.scss'\r\n\r\nexport default memo(function({\r\n\tthumbnail,\r\n\tclassName,\r\n\tchildren,\r\n}){\r\n\treturn <div className={'BookThumbnail square layered '+(thumbnail?'':'null ')+className}>\r\n\t\t{thumbnail?\r\n\t\t\t<img src={thumbnail} alt=\"book thumbnail\"/>:\r\n\t\t\t<svg width=\"100%\" height=\"100%\" viewBox=\"0 0 500 500\">\r\n\t\t\t\t<g transform=\"matrix(1.25,0,0,1,0,0)\">\r\n\t\t\t\t\t<g transform=\"matrix(2.5,0,0,3.125,-880,-700)\">\r\n\t\t\t\t\t\t<path d=\"M512,260.166C512,255.922 510.314,251.853 507.314,248.852C501.791,243.33 492.67,234.209 487.148,228.686C484.147,225.686 480.078,224 475.834,224L364.8,224C361.405,224 358.149,225.349 355.749,227.749C353.349,230.15 352,233.405 352,236.8L352,371.2C352,374.595 353.349,377.85 355.749,380.251C358.15,382.651 361.405,384 364.8,384L499.2,384C502.595,384 505.85,382.651 508.251,380.251C510.651,377.851 512,374.595 512,371.2L512,260.166Z\"/>\r\n\t\t\t\t\t</g>\r\n\t\t\t\t</g>\r\n\t\t\t</svg>}\r\n\t\t{children}\r\n\t</div>\r\n})","import React,{memo,createElement} from 'react'\r\nimport {Link,useLocation} from 'react-router-dom'\r\n\r\nimport './Group.scss'\r\nimport {MainContext} from '../../contexts/MainContext'\r\nimport {withContext} from '../../utils/hocs'\r\nimport BookThumbnail from '../BookThumbnail/BookThumbnail'\r\n\r\nexport default withContext(MainContext,[\r\n\t'BOOKS',\r\n\t'userId',\r\n],memo(function({\r\n\tBOOKS,\r\n\tuserId,\r\n\r\n\tgroup,\r\n\tclassName,\r\n}){\r\n\tconst {pathname}=useLocation()\r\n\tconst books=group.book_ids.map(bookId=>BOOKS[bookId])\r\n\tconst isAdmin=group.group_members.find(u=>u.user_id===userId)?.member_type==='admin' /* TODO: Admin indicator*/\r\n\treturn <Link to={pathname+'/group|'+group.id} className={'Group p-8 '+className}>\r\n\t\t<div className=\"group-title f-center\">\r\n\t\t\t<img className=\"banner m-8 mr-12 well\" src={require('../../assets/imgs/banner.png')} alt=\"Banner\"/>\r\n\t\t\t<div style={{width: 'calc(100% - 164px)'}}>\r\n\t\t\t\t<div className=\"col-12 one-line\">{group.title}</div>\r\n\t\t\t\t<div className=\"col-12 one-line h7 text-muted\">{group.bio}</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t\t<div className=\"row spc-12 mx-m12\">\r\n\t\t\t{createElement(\r\n\t\t\t\tbooks[0]?.id?Link:'div',\r\n\t\t\t\t{\r\n\t\t\t\t\tto: pathname+'/book|'+books[0]?.id,\r\n\t\t\t\t\tclassName: 'col-4 book f-vert',\r\n\t\t\t\t},\r\n\t\t\t\t<>\r\n\t\t\t\t\t<BookThumbnail thumbnail={books[0]?.thumbnail}/>\r\n\t\t\t\t\t<div className=\"pt-8\">\r\n\t\t\t\t\t\t<div className=\"one-line\">{books[0]?.title}</div>\r\n\t\t\t\t\t\t<div className=\"h7 text-muted one-line\">{books[0]?.description}</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</>\r\n\t\t\t)}\r\n\t\t\t{createElement(\r\n\t\t\t\tbooks[1]?.id?Link:'div',\r\n\t\t\t\t{\r\n\t\t\t\t\tto: pathname+'/book|'+books[1]?.id,\r\n\t\t\t\t\tclassName: 'col-4 book f-vert',\r\n\t\t\t\t},\r\n\t\t\t\t<>\r\n\t\t\t\t\t<BookThumbnail thumbnail={books[1]?.thumbnail}/>\r\n\t\t\t\t\t<div className=\"pt-8\">\r\n\t\t\t\t\t\t<div className=\"one-line\">{books[1]?.title}</div>\r\n\t\t\t\t\t\t<div className=\"h7 text-muted one-line\">{books[1]?.description}</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</>\r\n\t\t\t)}\r\n\t\t\t<div className=\"well col-4 row spc-12\">\r\n\t\t\t\t{books.slice(2,6).map(book=><BookThumbnail className=\"col-6\" thumbnail={book?.thumbnail}/>)}\r\n\t\t\t\t<BookThumbnail className=\"col-6\"/>\r\n\t\t\t\t<BookThumbnail className=\"col-6\"/>\r\n\t\t\t\t<BookThumbnail className=\"col-6\"/>\r\n\t\t\t\t<BookThumbnail className=\"col-6\"/>\r\n\t\t\t\t<hr className=\"col-12 mb-0\"/>\r\n\t\t\t\t<div className=\"col-12\">\r\n\t\t\t\t\t<div className=\"one-line\">{books.length} Books</div>\r\n\t\t\t\t\t<div className=\"h7 text-muted one-line\">3 Shelves</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t\t{/*<span className=\"well px-4 py-2 h7 text-muted mt-m12 mr-auto d-block\">*/}\r\n\t\t{/*\tLast Visited: 8 Hours ago*/}\r\n\t\t{/*</span>*/}\r\n\t\t<div className=\"text-right h7 text-muted mt-m4\">\r\n\t\t\tLast Visited: 8 Hours ago\r\n\t\t</div>\r\n\t</Link>\r\n}))\r\n","import React,{useEffect,useState,memo} from 'react'\r\nimport {Scrollbar} from 'react-scrollbars-custom'\r\n\r\nimport './PageDashboard.scss'\r\nimport Header from '../Header/Header'\r\nimport {MainContext,api,dispatch} from '../../contexts/MainContext'\r\nimport Group from '../Group/Group'\r\nimport Spinner from '../../utils/components/Spinner/Spinner'\r\nimport {withContext} from '../../utils/hocs'\r\n\r\nexport default withContext(MainContext,[\r\n\t'userId',\r\n\t'USERS',\r\n\t'GROUPS',\r\n],memo(function PageDashboard({\r\n\tuserId,\r\n\tUSERS,\r\n\tGROUPS,\r\n}){\r\n\tuseEffect(refresh,[userId])\r\n\tconst user=USERS[userId]\r\n\tconst [showSpinner,setShowSpinner]=useState(true)\r\n\r\n\tfunction refresh(){\r\n\t\tif(!userId) return\r\n\t\tsetShowSpinner(true)\r\n\t\tapi('get','groups-full').then(({data})=>{\r\n\t\t\tdata && dispatch(['SET_DATA',data])\r\n\t\t}).catch(console.error).finally(()=>setShowSpinner(false))\r\n\t}\r\n\r\n\treturn (\r\n\t\t<div id=\"PageDashboard\">\r\n\t\t\t<Scrollbar disableTracksWidthCompensation className=\"pos-abs stretch-to-fit\">\r\n\t\t\t\t<div className=\"f-vert\">\r\n\t\t\t\t\t<div className=\"container col-12 row spc-12\">\r\n\t\t\t\t\t\t<input className=\"col-12\" type=\"search\"/>\r\n\t\t\t\t\t\t<hr className=\"col-12\"/>\r\n\t\t\t\t\t\t{(user?.group_members || []).map(g=>{\r\n\t\t\t\t\t\t\tconst group=GROUPS[g?.group_id]\r\n\t\t\t\t\t\t\treturn group?(\r\n\t\t\t\t\t\t\t\t<Group className=\"col-4\" {...{key:g?.group_id,group}}/>\r\n\t\t\t\t\t\t\t):undefined\r\n\t\t\t\t\t\t})}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<Header>\r\n\t\t\t\t\t\t<div className=\"col\"/>\r\n\t\t\t\t\t\t<div className=\"icon icon-refresh super-center\" onClick={refresh}/>\r\n\t\t\t\t\t</Header>\r\n\t\t\t\t</div>\r\n\t\t\t</Scrollbar>\r\n\t\t\t<Spinner {...{className: showSpinner?'active':''}}/>\r\n\t\t</div>\r\n\t)\r\n}))\r\n","import React from 'react'\r\nimport _ from 'lodash'\r\n\r\nimport './PageLogin.scss'\r\nimport SegmentControls from '../../utils/components/SegmentControls/SegmentControls'\r\nimport MyComponent from '../MyComponent'\r\nimport {MainContext,api,passwordRegex,token,dispatch} from '../../contexts/MainContext'\r\nimport Spinner from '../../utils/components/Spinner/Spinner'\r\nimport {setAlert} from '../../utils/components/Alert/Alert'\r\n\r\n// TODO: fix below\r\nconst initState=JSON.stringify({\r\n\tmode: 0,\r\n\tshowSpinner: false,\r\n})\r\nexport default class PageLogin extends MyComponent{\r\n\tstatic contextType=MainContext\r\n\tstate=JSON.parse(initState)\r\n\r\n\tlogin=async e=>{\r\n\t\te.preventDefault()\r\n\t\tthis.setState({showSpinner: true})\r\n\r\n\t\ttry{\r\n\t\t\tconst {data}=await api(\r\n\t\t\t\t'post',\r\n\t\t\t\t'login',\r\n\t\t\t\t_.pick(this.state,['email','password']),\r\n\t\t\t)\r\n\t\t\tif(data) dispatch(['LOGIN',data])\r\n\t\t}finally{this.setState({showSpinner: false})}\r\n\t}\r\n\r\n\tsignUp=async e=>{\r\n\t\te.preventDefault()\r\n\t\tthis.setState({showSpinner: true})\r\n\r\n\t\ttry{\r\n\t\t\tawait api('post','register',_.pick(this.state,['email']))\r\n\t\t\tthis.setState(JSON.parse(initState))\r\n\t\t\tsetAlert(<div className=\"row spc-12\" style={{maxWidth: '320px'}}>\r\n\t\t\t\t<div className=\"col-12 h5\">&#x2713; Email Sent</div>\r\n\t\t\t\t<div className=\"col-12 h7 text-muted\">\r\n\t\t\t\t\tWe just sent an email to <b className=\"text-unmuted\">{this.state.email}</b>.\r\n\t\t\t\t\tCheck your email to complete your sign-up!\r\n\t\t\t\t\t<br/><br/>\r\n\t\t\t\t\tIf you did not receive any emails from us, don't forget to check your spam folder!\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"bottom-row col-ext-x col-ext-b col-12 row spc-x-12 spc-y-8 f-justify-end\">\r\n\t\t\t\t\t<button onClick={()=>setAlert()}>OK</button>\r\n\t\t\t\t</div>\r\n\t\t\t</div>)\r\n\t\t}finally{this.setState({showSpinner: false})}\r\n\t}\r\n\r\n\trender(){\r\n\t\tconst {login,signUp}=this\r\n\t\tconst {location,history}=this.props\r\n\t\tconst {mode,showSpinner}=this.state\r\n\t\tconst {version}=this.context\r\n\r\n\t\t// TODO: Re-evaluate strategy\r\n\t\t// If logged in, bypass login screen\r\n\t\tif(token)\r\n\t\t\thistory.replace(location.pathname.replace('/login',''))\r\n\r\n\t\treturn (\r\n\t\t\t<div id=\"PageLogin\" className=\"pos-abs stretch-to-fit\">\r\n\t\t\t\t<div className=\"container row p-32\">\r\n\t\t\t\t\t<div className=\"col\">\r\n\t\t\t\t\t\t<h1 className=\"heading py-32\">\r\n\t\t\t\t\t\t\tBBBook<sup className=\"h7 normal-caps ml-8\" style={{height: 'auto'}}>Pre-Alpha {version}</sup>\r\n\t\t\t\t\t\t</h1>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div className=\"card row spc-16 f-vert pos-rel\" style={{width: '360px'}}>\r\n\t\t\t\t\t\t<SegmentControls value={mode}>\r\n\t\t\t\t\t\t\t<div className=\"super-center\" onClick={()=>this.setState({mode: 0})}>Log In</div>\r\n\t\t\t\t\t\t\t<div className=\"super-center\" onClick={()=>this.setState({mode: 1})}>Sign up</div>\r\n\t\t\t\t\t\t</SegmentControls>\r\n\t\t\t\t\t\t{mode===0?\r\n\t\t\t\t\t\t\t<form className=\"row spc-16 f-vert col col-ext pos-rel trim\" onSubmit={login}>\r\n\t\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\t\t<h1>Log In</h1>\r\n\t\t\t\t\t\t\t\t\t<div className=\"h7 text-muted\">Enter the BBBook portal.</div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t<div className=\"col\"/>\r\n\t\t\t\t\t\t\t\t<label required className=\"h7 mt-0 mb-m4\">Email</label>\r\n\t\t\t\t\t\t\t\t<input required {...this.twoWayBind('email')} name=\"email\" type=\"email\" autoComplete=\"email\"/>\r\n\t\t\t\t\t\t\t\t<label required className=\"h7 mt-0 mb-m4\">Password</label>\r\n\t\t\t\t\t\t\t\t<input required {...this.twoWayBind('password')} name=\"password\" type=\"password\" pattern={passwordRegex} autoComplete=\"current-password\"/>\r\n\t\t\t\t\t\t\t\t{/*<Link className=\"button super-center\" to=\"/dashboard\">Log In</Link>*/}\r\n\t\t\t\t\t\t\t\t<div className=\"bottom-row col-ext-x col-ext-b text-right row f-vert spc-x-16 spc-y-12\">\r\n\t\t\t\t\t\t\t\t\t<button>Log In</button>\r\n\t\t\t\t\t\t\t\t\t<hr className=\"col-ext-x\"/>\r\n\t\t\t\t\t\t\t\t\t<div className=\"h7 text-right my-2\" onClick={()=>this.setState({mode: 1})}>New to BBBook? Sign up!</div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</form>\r\n\t\t\t\t\t\t\t:<form className=\"row spc-16 f-vert col col-ext pos-rel trim\" onSubmit={signUp}>\r\n\t\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\t\t<h1>Sign Up</h1>\r\n\t\t\t\t\t\t\t\t\t<div className=\"h7 text-muted\">Enter the BBBook portal.</div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t<div className=\"col\"/>\r\n\t\t\t\t\t\t\t\t<label required className=\"h7 mt-0 mb-m4\">Email</label>\r\n\t\t\t\t\t\t\t\t<input required {...this.twoWayBind('email')} name=\"email\" type=\"email\"/>\r\n\t\t\t\t\t\t\t\t{/*<Link className=\"button super-center\" to=\"/dashboard\">Sign Up</Link>*/}\r\n\t\t\t\t\t\t\t\t<div className=\"bottom-row col-ext-x col-ext-b text-right row f-vert spc-x-16 spc-y-12\">\r\n\t\t\t\t\t\t\t\t\t<button>Sign Up</button>\r\n\t\t\t\t\t\t\t\t\t<hr className=\"col-ext-x\"/>\r\n\t\t\t\t\t\t\t\t\t<div className=\"h7 text-right my-2\" onClick={()=>this.setState({mode: 0})}>Have an account? Log in!</div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</form>\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<Spinner {...{className: showSpinner?'active':''}}/>\r\n\t\t\t</div>\r\n\t\t)\r\n\t}\r\n}\r\n","import React,{createElement} from 'react'\r\n\r\nexport default function TabsRow({value,className,children,...props}){\r\n\tconst val=Number.isInteger(value)?value:-1\r\n\treturn <div {...props} className={'TabsRow row '+(className || '')}>\r\n\t\t{(children || []).map((child,i)=>createElement(\r\n\t\t\tchild.type,\r\n\t\t\t{\r\n\t\t\t\t...child.props,\r\n\t\t\t\tclassName: (child.props.className || '')+(i===val?' active':''),\r\n\t\t\t}\r\n\t\t))}\r\n\t</div>\r\n}","import React,{useEffect,useState,memo} from 'react'\r\nimport {Link} from 'react-router-dom'\r\nimport {Scrollbar} from 'react-scrollbars-custom'\r\n\r\nimport './PageGroups.scss'\r\nimport Header from '../Header/Header'\r\nimport {MainContext,api,dispatch,history} from '../../contexts/MainContext'\r\nimport Group from '../Group/Group'\r\nimport Spinner from '../../utils/components/Spinner/Spinner'\r\nimport {withContext} from '../../utils/hocs'\r\nimport TabsRow from '../../utils/components/TabsRow/TabsRow'\r\n\r\nexport default withContext(MainContext,[\r\n\t'userId',\r\n\t'USERS',\r\n\t'GROUPS'\r\n],memo(function PageGroups({\r\n\tuserId,\r\n\tUSERS,\r\n\tGROUPS\r\n}){\r\n\tuseEffect(refresh,[userId])\r\n\tconst user=USERS[userId]\r\n\tconst [showSpinner,setShowSpinner]=useState(true)\r\n\r\n\tfunction refresh(){\r\n\t\tif(!userId) return\r\n\t\tsetShowSpinner(true)\r\n\t\tapi('get','groups-full').then(({data})=>{\r\n\t\t\tdata && dispatch(['SET_DATA',data])\r\n\t\t}).catch(console.error).finally(()=>setShowSpinner(false))\r\n\t}\r\n\r\n\treturn <section id=\"PageGroups\">\r\n\t\t<Scrollbar disableTracksWidthCompensation className=\"pos-abs stretch-to-fit\">\r\n\t\t\t<div className=\"container col-12\">\r\n\t\t\t\t<div className=\"row f-center px-12\"> {/* TODO: New Header */}\r\n\t\t\t\t\t<h1 className=\"py-16\" style={{fontSize: '48px'}}>Groups</h1>\r\n\t\t\t\t\t<div className=\"col\"/>\r\n\t\t\t\t\t<div className=\"icon icon-refresh super-center well\" onClick={refresh}/> {/* TODO: Replace refresh icon*/}\r\n\t\t\t\t</div>\r\n\t\t\t\t<hr style={{transform: 'rotate(180deg)'}}/>\r\n\t\t\t\t<div className=\"row spc-x-12 f-center\">\r\n\t\t\t\t\t<TabsRow value={0} className=\"col-ext-x\">\r\n\t\t\t\t\t\t<div>All Groups</div>\r\n\t\t\t\t\t\t<div>My Groups</div>\r\n\t\t\t\t\t</TabsRow>\r\n\t\t\t\t\t<div className=\"col\"/>\r\n\t\t\t\t\t<input type=\"search\" className=\"col-4\"/>\r\n\t\t\t\t\t{/* TODO: View, sort by, group by*/}\r\n\t\t\t\t</div>\r\n\t\t\t\t<hr/>\r\n\t\t\t\t<div className=\"groups row spc-16\">\r\n\t\t\t\t\t{/*<input className=\"col-12\" type=\"search\"/>*/}\r\n\t\t\t\t\t{/*<hr className=\"col-12\"/>*/}\r\n\t\t\t\t\t{(user?.group_members || []).map(g=>{\r\n\t\t\t\t\t\tconst group=GROUPS[g?.group_id]\r\n\t\t\t\t\t\treturn group?\r\n\t\t\t\t\t\t\t<Group className=\"col-4\" {...{key:g?.group_id,group}}/>:\r\n\t\t\t\t\t\t\tundefined\r\n\t\t\t\t\t})}\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</Scrollbar>\r\n\t\t<Link className=\"button f-center f-horz-rev pos-abs create-group-btn p-0\" to={history.location.pathname+'/edit-group/0'}>\r\n\t\t\t<i className=\"fa fa-plus super-center h5\"/>\r\n\t\t\t<div className=\"super-center pl-24 pr-12 one-line\">Create Group</div>\r\n\t\t</Link>\r\n\t\t<Spinner {...{className: showSpinner?'active':''}}/> {/* TODO: In page spinner*/}\r\n\t</section>\r\n}))\r\n","import React from 'react'\r\nimport {Link} from 'react-router-dom'\r\n// import _ from 'lodash'\r\nimport {Scrollbar} from 'react-scrollbars-custom'\r\n\r\nimport './PageRegister.scss'\r\nimport MyComponent from '../MyComponent'\r\nimport {MainContext,passwordRegex,api} from '../../contexts/MainContext'\r\nimport Spinner from '../../utils/components/Spinner/Spinner'\r\nimport {setAlert} from '../../utils/components/Alert/Alert'\r\n// import {setAlert} from '../../utils/Alert/Alert'\r\n\r\n\r\nexport default class PageRegister extends MyComponent{\r\n\tstatic contextType=MainContext\r\n\tstate={}\r\n\tshowSpinner=true\r\n\r\n\tcomponentDidMount=async ()=>{\r\n\t\tconsole.log(this.props.match.params.id)\r\n\t\ttry{\r\n\t\t\tconst {data}=await api('post','get-email',{id: this.props.match.params.id})\r\n\t\t\t// console.log(email)\r\n\t\t\tthis.setState({email: data})\r\n\t\t}finally{\r\n\t\t\tthis.showSpinner=false\r\n\t\t\tthis.forceUpdate()\r\n\t\t}\r\n\t}\r\n\r\n\tonSubmit=async e=>{\r\n\t\te.preventDefault()\r\n\t\tthis.showSpinner=true\r\n\t\tthis.forceUpdate()\r\n\t\ttry{\r\n\t\t\tawait api('post','sign-up',{...this.state,email: this.props.match.params.id})\r\n\t\t\tsetAlert(<div className=\"row spc-12\" style={{maxWidth: '320px'}}>\r\n\t\t\t\t<div className=\"col-12 h5\">&#x2713; Account Created</div>\r\n\t\t\t\t<div className=\"col-12 h7 text-muted\">\r\n\t\t\t\t\tWelcome to BBBook! Your account was created successfully. Please login to enter.\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"bottom-row col-ext-x col-ext-b col-12 row spc-x-12 spc-y-8 f-justify-end\">\r\n\t\t\t\t\t<button onClick={()=>setAlert()}>OK</button>\r\n\t\t\t\t</div>\r\n\t\t\t</div>)\r\n\t\t\tthis.props.history.replace('/login')\r\n\t\t}finally{\r\n\t\t\tthis.showSpinner=false\r\n\t\t\tthis.forceUpdate()\r\n\t\t}\r\n\t\tconsole.log(this.state)\r\n\t}\r\n\r\n\t// TODO: Regex\r\n\t// TODO: autoComplete\r\n\t// TODO: change-password URL\r\n\t// TODO: https://web.dev/sign-up-form-best-practices/\r\n\trender(){\r\n\t\tconst {onSubmit,showSpinner}=this\r\n\t\tconst {email}=this.state\r\n\t\tconst {version}=this.context\r\n\t\treturn (\r\n\t\t\t<div id=\"PageRegister\" className=\"pos-abs stretch-to-fit\">\r\n\t\t\t\t<div className=\"container row p-32\">\r\n\t\t\t\t\t<div className=\"col\">\r\n\t\t\t\t\t\t<h1 className=\"heading py-32\">\r\n\t\t\t\t\t\t\tBBBook<sup className=\"h7 normal-caps ml-8\" style={{height: 'auto'}}>Pre-Alpha {version}</sup>\r\n\t\t\t\t\t\t</h1>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<Scrollbar disableTracksWidthCompensation className=\"card main-card\" style={{width: '360px'}}>\r\n\t\t\t\t\t\t<form className=\"row spc-16 f-vert col col-ext pos-rel trim\" {...{onSubmit}}>\r\n\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\t<h1>Sign Up</h1>\r\n\t\t\t\t\t\t\t\t<div className=\"h7 text-muted\">Complete your details.</div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<div className=\"col\"/>\r\n\t\t\t\t\t\t\t<label className=\"h7 mt-0 mb-m4\">Email</label>\r\n\t\t\t\t\t\t\t{/*<input required name=\"email\" type=\"email\" value={email} readOnly/>*/}\r\n\t\t\t\t\t\t\t<div className=\"button outline\">{email}</div>\r\n\t\t\t\t\t\t\t<label required className=\"h7 mt-0 mb-m4\">Username</label>\r\n\t\t\t\t\t\t\t<input required {...this.twoWayBind('username')} name=\"username\" type=\"text\" autoComplete=\"username\"/>\r\n\t\t\t\t\t\t\t<label required className=\"h7 mt-0 mb-m4\">First Name</label>\r\n\t\t\t\t\t\t\t<input required {...this.twoWayBind('first_name')} name=\"first_name\" type=\"text\" autoComplete=\"given-name\"/>\r\n\t\t\t\t\t\t\t<label required className=\"h7 mt-0 mb-m4\">Last Name</label>\r\n\t\t\t\t\t\t\t<input required {...this.twoWayBind('last_name')} name=\"last_name\" type=\"text\" autoComplete=\"family-name\"/>\r\n\t\t\t\t\t\t\t<label required className=\"h7 mt-0 mb-m4\">Password</label>\r\n\t\t\t\t\t\t\t<input required {...this.twoWayBind('password')} name=\"password\" type=\"password\" pattern={passwordRegex} autoComplete=\"new-password\"/>\r\n\t\t\t\t\t\t\t<label required className=\"h7 mt-0 mb-m4\">Confirm Password</label>\r\n\t\t\t\t\t\t\t<input required {...this.twoWayBind('password_2')} name=\"password_2\" type=\"password\" pattern={passwordRegex} autoComplete=\"new-password\"/>\r\n\t\t\t\t\t\t\t<label required className=\"h7 mt-0 mb-m4\">Date of Birth</label>\r\n\t\t\t\t\t\t\t<input required {...this.twoWayBind('birth_date')} name=\"birth_date\" type=\"date\" autoComplete=\"bday\"/>\r\n\t\t\t\t\t\t\t<label className=\"h7 mt-0 mb-m4\">Bio</label>\r\n\t\t\t\t\t\t\t<textarea {...this.twoWayBind('bio')} name=\"bio\"/>\r\n\t\t\t\t\t\t\t{/* TODO: Avatar\t*/}\r\n\t\t\t\t\t\t\t<div className=\"bottom-row col-ext-x col-ext-b text-right row f-vert spc-x-16 spc-y-12\">\r\n\t\t\t\t\t\t\t\t<button>Complete</button>\r\n\t\t\t\t\t\t\t\t<hr className=\"col-ext-x\"/>\r\n\t\t\t\t\t\t\t\t<Link to=\"/login\" className=\"h7 text-right my-2\">Have an account? Log in!</Link>\r\n\t\t\t\t\t\t\t\t{/*<hr className=\"col-ext-x\"/>\r\n\t\t\t\t\t\t\t\t<div className=\"h7 text-right my-2\" onClick={()=>this.setState({mode: 1})}>New to BBBook? Sign up!</div>*/}\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</form>\r\n\t\t\t\t\t</Scrollbar>\r\n\t\t\t\t</div>\r\n\t\t\t\t<Spinner {...{className: showSpinner?'active':''}}/>\r\n\t\t\t</div>\r\n\t\t)\r\n\t}\r\n}\r\n","import React from 'react'\r\nimport {Link} from 'react-router-dom'\r\nimport _ from 'lodash'\r\nimport {Scrollbar} from 'react-scrollbars-custom'\r\n\r\nimport './ModalEditGroup.scss'\r\nimport MyComponent from '../MyComponent'\r\nimport SegmentControls from '../../utils/components/SegmentControls/SegmentControls'\r\nimport {MainContext,api,dispatch} from '../../contexts/MainContext'\r\nimport Spinner from '../../utils/components/Spinner/Spinner'\r\nimport {setAlert} from '../../utils/components/Alert/Alert'\r\n\r\n// TODO: Admin revoked - alert\r\n// TODO: ManageUsers Component\r\nexport default class ModalEditGroup extends MyComponent{\r\n\tstatic contextType=MainContext\r\n\t// TODO: Take it outside state\r\n\tstate={\r\n\t\tpublicPrivate: 1,\r\n\t\tlinkSharing: 1,\r\n\t\tshowSpinner: false,\r\n\t}\r\n\r\n\trender(){\r\n\t\tconst {onSubmit,archiveGroup}=this\r\n\t\tconst {location,history}=this.props\r\n\t\tconst {publicPrivate,linkSharing,showSpinner}=this.state\r\n\t\tconst {id}=this.props.match.params\r\n\t\tconst {userId,GROUPS,USERS}=this.context\r\n\t\tconst group=GROUPS[id]\r\n\r\n\t\tif(!userId) return null\r\n\t\tif(id!=='0'){\r\n\t\t\tif(!group) return null\r\n\t\t\tif(this.state.id!==id) this.groupTypeToState(group)\r\n\t\t}\r\n\r\n\t\tconst manageUsersMode=location.pathname.indexOf('/edit-group-users')!==-1\r\n\t\treturn (\r\n\t\t\t<div id=\"ModalEditGroup\" className=\"modal active\">\r\n\t\t\t\t<form className={manageUsersMode?'expanded':''} {...{onSubmit}}>\r\n\t\t\t\t\t<div className=\"row spc-12\">\r\n\t\t\t\t\t\t<h3 className=\"col\">{id==='0'?'New':'Edit'} Group</h3>\r\n\t\t\t\t\t\t{/* TODO: Show group details in manageUsersMode */}\r\n\t\t\t\t\t\t{/*<div><button className=\"outline\" style={{width: '68px',height: '68px',marginBottom: '-45px'}}/></div>*/}\r\n\t\t\t\t\t\t<hr className=\"col-12 col-ext-x col-ext-b\"/>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t{!manageUsersMode?\r\n\t\t\t\t\t\t<div className=\"row spc-12\">\r\n\t\t\t\t\t\t\t<div className=\"col\">\r\n\t\t\t\t\t\t\t\t<label required className=\"h7 mb-4\">Group Name</label>\r\n\t\t\t\t\t\t\t\t<input required className=\"col-12\" type=\"text\" {...this.twoWayBind('title')}/>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<div className=\"col-12\">\r\n\t\t\t\t\t\t\t\t<label className=\"h7 mb-4\">Group Description</label>\r\n\t\t\t\t\t\t\t\t<textarea className=\"col-12\" {...this.twoWayBind('bio')}/>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<div className=\"col-6\">\r\n\t\t\t\t\t\t\t\t<label className=\"h7 mb-4\">Group Privacy</label>\r\n\t\t\t\t\t\t\t\t<SegmentControls value={publicPrivate}>\r\n\t\t\t\t\t\t\t\t\t<div className=\"super-center\" onClick={()=>this.setState({publicPrivate: 0,linkSharing: 0})}>Public</div>\r\n\t\t\t\t\t\t\t\t\t<div className=\"super-center\" onClick={()=>this.setState({publicPrivate: 1})}>Private</div>\r\n\t\t\t\t\t\t\t\t</SegmentControls>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<div className=\"col-6\">\r\n\t\t\t\t\t\t\t\t<label className=\"h7 mb-4\" disabled={publicPrivate===0}>Invite via Link</label>\r\n\t\t\t\t\t\t\t\t<SegmentControls value={linkSharing} disabled={publicPrivate===0}>\r\n\t\t\t\t\t\t\t\t\t<div className=\"super-center\" onClick={()=>this.setState({linkSharing: 0})}>Enabled</div>\r\n\t\t\t\t\t\t\t\t\t<div className=\"super-center\" onClick={()=>this.setState({linkSharing: 1})}>Disabled</div>\r\n\t\t\t\t\t\t\t\t</SegmentControls>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t{/* TODO: Green accent for link sharing enabled */}\r\n\t\t\t\t\t\t\t{id!=='0'?<div className=\"col-12 f-vert\">\r\n\t\t\t\t\t\t\t\t<label className=\"h7 mb-4\">Link</label>\r\n\t\t\t\t\t\t\t\t<Link\r\n\t\t\t\t\t\t\t\t\tto={'/groups/group|'+id}\r\n\t\t\t\t\t\t\t\t\ttarget=\"_blank\"\r\n\t\t\t\t\t\t\t\t\tclassName=\"col-12 button outline d-block one-line\"\r\n\t\t\t\t\t\t\t\t\ttype=\"text\" {...this.twoWayBind('title')}>\r\n\t\t\t\t\t\t\t\t\t{window.location.origin+'/#/groups/group|'+id}\r\n\t\t\t\t\t\t\t\t</Link>\r\n\t\t\t\t\t\t\t\t<div className=\"button ml-auto h7 mt-6\" style={{height: 'auto'}}>Copy Link</div>\r\n\t\t\t\t\t\t\t\t<div className=\"button outline row spc-12 mt-12\" style={{height: 'auto'}}>\r\n\t\t\t\t\t\t\t\t\t<div className=\"col\">Administrative actions</div>\r\n\t\t\t\t\t\t\t\t\t<div className=\"button outline\" onClick={archiveGroup}>Archive Group</div>\r\n\t\t\t\t\t\t\t\t\t<div className=\"button\">Delete Group</div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>:undefined}\r\n\t\t\t\t\t\t</div>:\r\n\t\t\t\t\t\t<Scrollbar disableTracksWidthCompensation style={{height: 'calc(100% - 114px)'}}>\r\n\t\t\t\t\t\t\t<div className=\"row spc-12 container\">\r\n\t\t\t\t\t\t\t\t<div className=\"col-12 row f-center\">\r\n\t\t\t\t\t\t\t\t\tAdmins <hr className=\"col ml-16\"/>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t<div className=\"col-12 row f-center f-order-1\">\r\n\t\t\t\t\t\t\t\t\tUsers <hr className=\"col ml-16\"/>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t{group.group_members.map(u=>{\r\n\t\t\t\t\t\t\t\t\tconst user=USERS[u.user_id]\r\n\t\t\t\t\t\t\t\t\treturn user?<div key={u} className={'card col-3 row spc-12 f-center'+(u.member_type==='admin'?'':' f-order-1')}>\r\n\t\t\t\t\t\t\t\t\t\t<img\r\n\t\t\t\t\t\t\t\t\t\t\tclassName=\"card col-ext-y col-ext-l\"\r\n\t\t\t\t\t\t\t\t\t\t\tsrc={require('../../assets/imgs/default-profile-icon.jpg')}\r\n\t\t\t\t\t\t\t\t\t\t\tstyle={{width: '61px',height: '61px',borderRadius: '8px 0 0 8px'}}\r\n\t\t\t\t\t\t\t\t\t\t\talt=\"user profile pic\"/>\r\n\t\t\t\t\t\t\t\t\t\t<div className=\"col one-line\">\r\n\t\t\t\t\t\t\t\t\t\t\t{user.first_name || 'First Name'} {user.last_name || 'Last Name'}\r\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"h7 text-muted mt-2\">@{user.username} | {user.email}</div>\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t</div>:undefined\r\n\t\t\t\t\t\t\t\t})}\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</Scrollbar>\r\n\t\t\t\t\t}\r\n\t\t\t\t\t<div className=\"bottom-row col-12 col-ext row spc-12\">\r\n\t\t\t\t\t\t{(id!=='0' && !manageUsersMode)?<>\r\n\t\t\t\t\t\t\t<Link\r\n\t\t\t\t\t\t\t\tto={location.pathname+'/edit-group-users'}\r\n\t\t\t\t\t\t\t\tclassName=\"button super-center\">Manage Users</Link>\r\n\t\t\t\t\t\t\t<div className=\"f-self-center h7\">\r\n\t\t\t\t\t\t\t\t<i className=\"icon icon-users\"/> {group?.group_members.length}\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</>:undefined}\r\n\t\t\t\t\t\t<div className=\"col\"/>\r\n\t\t\t\t\t\t<div className=\"button outline super-center\" onClick={history.goBack}>Cancel</div>\r\n\t\t\t\t\t\t<button>{id==='0'?'Create Group':'Save'}</button>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<Spinner className={showSpinner?'active':''}/>\r\n\t\t\t\t\t<div className=\"close-btn\" onClick={history.goBack}/>\r\n\t\t\t\t</form>\r\n\t\t\t</div>\r\n\t\t)\r\n\t}\r\n\r\n\t// TODO: Avatar\r\n\tonSubmit=async e=>{\r\n\t\te.preventDefault()\r\n\t\tconst {id}=this.props.match.params\r\n\t\tconst {userId}=this.context\r\n\t\tlet group={\r\n\t\t\t..._.omit(this.state,['publicPrivate','linkSharing','showSpinner']),\r\n\t\t\tgroup_type: this.stateToGroupType(),\r\n\t\t}\r\n\r\n\t\tthis.setState({showSpinner: true})\r\n\t\ttry{\r\n\t\t\tif(id==='0'){\r\n\t\t\t\tgroup={\r\n\t\t\t\t\t...group,\r\n\t\t\t\t\tgroup_members: [{\r\n\t\t\t\t\t\tuser_id: userId,\r\n\t\t\t\t\t\tmember_type: 'admin',\r\n\t\t\t\t\t}],\r\n\t\t\t\t\tbooks: [],\r\n\t\t\t\t}\r\n\t\t\t\tconst {data}=await api('post','group',group)\r\n\t\t\t\tdata && dispatch(['SET_DATA',data])\r\n\t\t\t\tthis.props.history.goBack() // TODO: Remove\r\n\t\t\t}else{\r\n\t\t\t\tconst {data}=await api('put','group',group)\r\n\t\t\t\tdata && dispatch(['SET_DATA',data])\r\n\t\t\t}\r\n\t\t}finally{\r\n\t\t\tthis.setState({showSpinner: false})\r\n\t\t}\r\n\t}\r\n\r\n\tarchiveGroup=async ()=>{\r\n\t\tawait new Promise((resolve,reject)=>setAlert(<div className=\"row spc-12\" style={{width: 320}}>\r\n\t\t\t<div className=\"col-12 h5\">&#xf071; Warning</div>\r\n\t\t\t<div className=\"col-12 h7 text-muted\">\r\n\t\t\t\tDo you want to archive this group? Archiving the group will prevent any public comments, questions, etc. to be posted.\r\n\t\t\t</div>\r\n\t\t\t<div className=\"bottom-row col-ext-x col-ext-b col-12 row spc-x-12 spc-y-8 f-justify-end\">\r\n\t\t\t\t<button className=\"outline\" onClick={()=>{setAlert();resolve()}}>Archive</button>\r\n\t\t\t\t<button onClick={()=>{setAlert();reject()}}>Cancel</button>\r\n\t\t\t</div>\r\n\t\t</div>))\r\n\t\tconst {data}=await api('put','archive-group',{id: this.props.match.params.id,value: true})\r\n\t}\r\n\r\n\t// Group types\r\n\t// - public       -     searchable,    link-admit\r\n\t// - private      - non-searchable, no link-admit\r\n\t// - private-link - non-searchable,    link-admit\r\n\r\n\tgroupTypeToState=group=>{\r\n\t\tthis.setState({\r\n\t\t\t..._.cloneDeep(group),\r\n\t\t\tpublicPrivate: group.group_type==='public'?0:1,\r\n\t\t\tlinkSharing: group.group_type!=='private'?0:1,\r\n\t\t})\r\n\t}\r\n\r\n\tstateToGroupType=()=>{\r\n\t\tconst {publicPrivate,linkSharing}=this.state\r\n\t\tif(publicPrivate===0) return 'public'\r\n\t\telse if(linkSharing===0) return 'private-link'\r\n\t\telse return 'private'\r\n\t}\r\n}\r\n","import React from 'react'\nimport {Route,Switch,withRouter} from 'react-router-dom'\n\nimport './App.scss'\nimport {dispatch,token} from '../../contexts/MainContext'\nimport Sidemenu from '../Sidemenu/Sidemenu'\nimport Dashboard from '../PageDashboard/PageDashboard'\nimport PageBook from '../PageBook/PageBook'\nimport PageLogin from '../PageLogin/PageLogin'\nimport Alert from '../../utils/components/Alert/Alert'\nimport PageGroups from '../PageGroups/PageGroups'\nimport PageRegister from '../PageRegister/PageRegister'\nimport ModalEditGroup from '../ModalEditGroup/ModalEditGroup'\nimport PageGroup from '../PageGroup/PageGroup'\nimport ModalEditBook from '../ModalEditBook/ModalEditBook'\nimport {useForceUpdate} from '../../utils/hooks'\n\n// TODO: Protected routes pattern\nexport let forceUpdateApp\n// window.setInterval(()=>forceUpdateApp && forceUpdateApp(),2000)\nexport default withRouter(function App({location,history}){\n\tconsole.log('App render')\n\tforceUpdateApp=useForceUpdate()\n\n\tif(location.pathname==='/')\n\t\thistory.replace('/groups') // TODO: Change\n\n\t// Routes containing /login can appear without token present\n\tif(!token && location.pathname.indexOf('/login')===-1)\n\t\thistory.replace(location.pathname+'/login')\n\n\t// console.log('App Render')\n\treturn <div id=\"App\">\n\t\t<Sidemenu/>\n\t\t<div id=\"main-content\" className=\"pos-abs stretch-to-fit\">\n\t\t\t<Switch>\n\t\t\t\t{/* Level 1 */}\n\t\t\t\t<Route path=\"*/group|:id\" component={PageGroup}/>\n\n\t\t\t\t{/* Level 0 */}\n\t\t\t\t{/*<Route path=\"/dashboard\" component={Dashboard}/>*/}\n\t\t\t\t<Route path=\"/groups\" component={PageGroups}/>\n\t\t\t</Switch>\n\t\t\t<Route path=\"*/edit-group/:id\" component={ModalEditGroup}/>\n\t\t</div>\n\t\t{/*<Route path=\"* /book|:id\" component={PageBook}/>*/}\n\t\t<Route path=\"*/book|:bookId\" children={<PageBook/>}/>\n\t\t<Route path=\"*/edit-book|:groupId|:id\" component={ModalEditBook}/>\n\n\t\t{/* Routes containing /login can appear without token present */}\n\t\t<Route path=\"*/login\" component={PageLogin}/>\n\t\t<Route path=\"*/login-register/:id\" component={PageRegister}/>\n\n\t\t{/* Activated when Sidemenu active to prevent clicks over main-content */}\n\t\t<div\n\t\t\tid=\"shield\"\n\t\t\tclassName=\"hide pos-abs stretch-to-fit\"\n\t\t\tonClick={()=>dispatch(['SET_UI_SIDEMENU',false])}\n\t\t/>\n\t\t<Alert/>\n\t</div>\n})\n","import React,{useEffect,useState,memo} from 'react'\r\nimport {Scrollbar} from 'react-scrollbars-custom'\r\n\r\nimport './PageGroup.scss'\r\n// import Header from '../Header/Header'\r\nimport {MainContext,api,dispatch} from '../../contexts/MainContext'\r\nimport Spinner from '../../utils/components/Spinner/Spinner'\r\nimport {withParamsMemoized,withContext} from '../../utils/hocs'\r\nimport {Link,useLocation} from 'react-router-dom'\r\nimport TabsRow from '../../utils/components/TabsRow/TabsRow'\r\nimport BookThumbnail from '../BookThumbnail/BookThumbnail'\r\n\r\nexport default withParamsMemoized(withContext(MainContext,[\r\n\t'userId',\r\n\t'GROUPS',\r\n\t'USERS',\r\n\t'BOOKS',\r\n],memo(function PageGroup({\r\n\tuserId,\r\n\tGROUPS,\r\n\tUSERS,\r\n\tBOOKS,\r\n\r\n\tparams,\r\n}){\r\n\tuseEffect(()=>{ refresh() },[params.id+userId]) // eslint-disable-line react-hooks/exhaustive-deps\r\n\tconst groupId=params.id\r\n\tconst group=GROUPS[groupId]\r\n\tconst user=USERS[userId]\r\n\tconst [showSpinner,setShowSpinner]=useState(true) // TODO: useLocal\r\n\tconst isAdmin=group?.group_members.find(u=>u.user_id===userId)?.member_type==='admin'\r\n\tconst {pathname}=useLocation()\r\n\r\n\tasync function refresh(){\r\n\t\tif(userId===null) return\r\n\t\tsetShowSpinner(true)\r\n\t\ttry{\r\n\t\t\tconst {data}=await api('get','group-full/'+params.id)\r\n\t\t\tdata && dispatch(['SET_DATA',data])\r\n\t\t}finally{ setShowSpinner(false) }\r\n\t}\r\n\r\n\tasync function joinGroup(){\r\n\t\tsetShowSpinner(true)\r\n\t\ttry{\r\n\t\t\tconst {data}=await api('put','join-group',{\r\n\t\t\t\tuser_id: userId,\r\n\t\t\t\tgroup_id: params.id\r\n\t\t\t})\r\n\t\t\tdata && dispatch(['SET_DATA',data])\r\n\t\t}finally{ setShowSpinner(false) }\r\n\t}\r\n\r\n\t// return <section id=\"PageGroup\">\r\n\t// \t<Scrollbar disableTracksWidthCompensation id=\"PageGroup\" className=\"pos-abs stretch-to-fit\">\r\n\t// \t\t<div className=\"f-vert f-grow-1\" style={{minHeight: '100%'}}>\r\n\t// \t\t\t<div className=\"banner\" style={{height: '400px'}}/>\r\n\t// \t\t\t<div className=\"card f-grow-1\">\r\n\t// \t\t\t\t<div className=\"container col-12\">\r\n\t// \t\t\t\t\t{group?<div className=\"group row spc-16\">\r\n\t// \t\t\t\t\t\t<div className=\"title pb-12 pos-rel\">\r\n\t// \t\t\t\t\t\t\t{/*<img className=\"mr-12\" src={require('../../assets/imgs/letter.png')} alt=\"Group icon\"/>*/}\r\n\t// \t\t\t\t\t\t\t<h3>{group.title}</h3>\r\n\t// \t\t\t\t\t\t\t<div className=\"h7 text-muted one-line\">{group.bio}</div>\r\n\t// \t\t\t\t\t\t</div>\r\n\t// \t\t\t\t\t\t<div className=\"col f-center users-mini f-horz-rev\">{group.group_members.map(g=>\r\n\t// \t\t\t\t\t\t\t<img src={require('../../assets/imgs/default-profile-icon.jpg')} alt=\"User Profile Image\" key={g.user_id}/>)}\r\n\t// \t\t\t\t\t\t</div>\r\n\t// \t\t\t\t\t\t{isAdmin?\r\n\t// \t\t\t\t\t\t\t<Link to={history.location.pathname+'/edit-group/'+group.id} className=\"fa fa-ellipsis-v h5 super-center px-12\"/>\r\n\t// \t\t\t\t\t\t\t:undefined}\r\n\t// \t\t\t\t\t\t<hr className=\"col-12 col-ext-y\"/>\r\n\t// \t\t\t\t\t\t{group.book_ids.map(bookId=>{\r\n\t// \t\t\t\t\t\t\tconst b=BOOKS[bookId]\r\n\t// \t\t\t\t\t\t\treturn b?(\r\n\t// \t\t\t\t\t\t\t\t<Link to={history.location.pathname+'/book|'+bookId} className=\"col-3 col-2-xl book f-vert\" key={bookId}>\r\n\t// \t\t\t\t\t\t\t\t\t<div className=\"square card pos-rel trim\">\r\n\t// \t\t\t\t\t\t\t\t\t\t<img className=\"pos-abs stretch-to-fit\" src={b.thumbnail || require('../../assets/imgs/letter.png')} alt=\"PageBook placeholder\"/>\r\n\t// \t\t\t\t\t\t\t\t\t</div>\r\n\t// \t\t\t\t\t\t\t\t\t<div className=\"pt-8\">\r\n\t// \t\t\t\t\t\t\t\t\t\t<div className=\"one-line\">{b.title}</div>\r\n\t// \t\t\t\t\t\t\t\t\t\t<div className=\"h7 text-muted one-line\">{b.description}</div>\r\n\t// \t\t\t\t\t\t\t\t\t</div>\r\n\t// \t\t\t\t\t\t\t\t</Link>\r\n\t// \t\t\t\t\t\t\t):undefined\r\n\t// \t\t\t\t\t\t})}\r\n\t// \t\t\t\t\t\t{isAdmin?<Link className=\"pos-rel col-3 col-2-xl add-book f-self-start\" to={history.location.pathname+`/edit-book|${group.id}|0`}>\r\n\t// \t\t\t\t\t\t\t<div className=\"square\"/>\r\n\t// \t\t\t\t\t\t\t<div className=\"pos-abs stretch-to-fit super-center f-vert\">\r\n\t// \t\t\t\t\t\t\t\t<h3 className=\"mb-6\">&#x002B;</h3>\r\n\t// \t\t\t\t\t\t\t\tAdd Book\r\n\t// \t\t\t\t\t\t\t</div>\r\n\t// \t\t\t\t\t\t</Link>:undefined}\r\n\t// \t\t\t\t\t</div>:undefined}\r\n\t// \t\t\t\t</div>\r\n\t// \t\t\t</div>\r\n\t// \t\t\t<Header>\r\n\t// \t\t\t\t<div className=\"icon icon-arrow_left f-order-m1 super-center\" onClick={history.goBack}/>\r\n\t// \t\t\t\t<div className=\"col\"/>\r\n\t// \t\t\t\t<div className=\"icon icon-refresh super-center\" onClick={refresh}/>\r\n\t// \t\t\t</Header>\r\n\t// \t\t</div>\r\n\t// \t</Scrollbar>\r\n\t// \t{(user?.group_members.findIndex(g=>g?.group_id===groupId)===-1)\r\n\t// \t\t|| true?<div className=\"pos-abs join-group stretch-to-fit row spc-12\">\r\n\t// \t\t<div className=\"f-self-center\">You aren't a member of this group yet. Would you like to join?</div>\r\n\t// \t\t<div className=\"col\"/>\r\n\t// \t\t<button style={{width: '60px'}} onClick={joinGroup}>Yes</button>\r\n\t// \t</div>:undefined}\r\n\t// \t<Spinner className={showSpinner?'active':''}/>\r\n\t// </section>\r\n\treturn <Scrollbar disableTracksWidthCompensation id=\"PageGroup\">\r\n\t\t{group?<div className=\"container\">\r\n\t\t\t<img className=\"well\" src={require('../../assets/imgs/banner.png')} alt=\"banner\"/>\r\n\t\t\t{/* TODO: Admin indicator */}\r\n\t\t\t<div className=\"p-12\">\r\n\t\t\t\t<h3 className=\"col-12 one-line\">{group.title}</h3>\r\n\t\t\t\t<div className=\"col-12 text-muted h7\">{group.bio}</div>\r\n\t\t\t</div>\r\n\t\t\t<hr style={{transform: 'rotate(180deg)'}}/>\r\n\t\t\t<div className=\"row spc-x-12 f-center\">\r\n\t\t\t\t<TabsRow value={1} className=\"col-ext-x\">\r\n\t\t\t\t\t<div>Updates</div>\r\n\t\t\t\t\t<div>Book Shelves</div>\r\n\t\t\t\t\t<div>Members</div>\r\n\t\t\t\t\t<div>Notifications</div>\r\n\t\t\t\t\t<div>Settings</div>\r\n\t\t\t\t</TabsRow>\r\n\t\t\t\t<div className=\"col\"/>\r\n\t\t\t\t<input type=\"search\" className=\"col-4\"/>\r\n\t\t\t\t{/* TODO: View, sort by, group by*/}\r\n\t\t\t</div>\r\n\t\t\t<hr/>\r\n\t\t\t<div className=\"row row-8 spc-24\">\r\n\t\t\t\t{group.book_ids.map(bookId=>{\r\n\t\t\t\t\tconst book=BOOKS[bookId]\r\n\t\t\t\t\treturn book?\r\n\t\t\t\t\t\t<Link to={pathname+'/book|'+book.id} className=\"col-1\">\r\n\t\t\t\t\t\t\t<BookThumbnail thumbnail={book.thumbnail}/>\r\n\t\t\t\t\t\t\t<div className=\"pt-8\">\r\n\t\t\t\t\t\t\t\t<div className=\"one-line\">{book.title}</div>\r\n\t\t\t\t\t\t\t\t<div className=\"h7 text-muted one-line\">{book.description}</div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</Link>:\r\n\t\t\t\t\t\tnull\r\n\t\t\t\t})}\r\n\t\t\t\t{isAdmin?<Link className=\"col-1\" to={pathname+`/edit-book|${group.id}|0`}>\r\n\t\t\t\t\t\t<BookThumbnail className=\"col-12\">\r\n\t\t\t\t\t\t\t<h3 className=\"super-center text-muted\">\r\n\t\t\t\t\t\t\t\t<div className=\"fa fa-plus\"/>\r\n\t\t\t\t\t\t\t</h3>\r\n\t\t\t\t\t\t</BookThumbnail>\r\n\t\t\t\t\t\t<div className=\"pt-8\">\r\n\t\t\t\t\t\t\t<div className=\"one-line\">Add Book</div>\r\n\t\t\t\t\t\t\t<div className=\"h7 text-muted one-line\">Upload a new PDF</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</Link>:undefined}\r\n\t\t\t</div>\r\n\t\t</div>:undefined}\r\n\t\t<Spinner className={showSpinner?'active':''}/>\r\n\t</Scrollbar>\r\n})))\r\n","import React,{useRef,useState,memo} from 'react'\r\nimport {Scrollbar} from 'react-scrollbars-custom'\r\nimport _ from 'lodash'\r\n\r\nimport './ModalEditBook.scss'\r\nimport Spinner from '../../utils/components/Spinner/Spinner'\r\nimport pdfjs,{PdfImage} from '../PdfRenderer/PdfRenderer'\r\nimport {fileToBase64} from '../../utils/helper'\r\nimport {api,MainContext,dispatch} from '../../contexts/MainContext'\r\nimport {useLocal} from '../../utils/hooks'\r\nimport {withContext} from '../../utils/hocs'\r\n\r\nexport default withContext(MainContext,[\r\n\t'GROUPS',\r\n],memo(function ModalEditBook({\r\n\tmatch,\r\n\thistory,\r\n\r\n\tGROUPS,\r\n}){\r\n\tconst local=useLocal({\r\n\t\tshowSpinner: false,\r\n\t})\r\n\tconst {id,groupId}=match.params\r\n\r\n\tconst [pdf,setPdf]=useState()\r\n\tconst ref=useRef()\r\n\r\n\treturn <div id=\"ModalEditBook\" className=\"modal active\">\r\n\t\t<form action=\"\" className=\"row\" {...{onSubmit,ref}}>\r\n\t\t\t{!pdf?\r\n\t\t\t\t<label className=\"col-6 p-12 upload-book super-center f-vert text-muted\">\r\n\t\t\t\t\t<i className=\"icon icon-upload h1\"/>\r\n\t\t\t\t\t<div className=\"mt-4 h7\">Upload</div>\r\n\t\t\t\t\t<input type=\"file\" className=\"h3 hide\" name=\"file\" accept=\".pdf\" {...{onChange}}/>\r\n\t\t\t\t</label>:\r\n\t\t\t\t<Scrollbar className=\"col-6 uploaded-book\" disableTracksWidthCompensation>\r\n\t\t\t\t\t<div className=\"row spc-12\">\r\n\t\t\t\t\t\t<div className=\"one-line col-12\">{pdf.name}</div>\r\n\t\t\t\t\t\t<div className=\"col-12 h8 mt-0 text-muted\">{pdf.pages.length} pages</div>\r\n\t\t\t\t\t\t<hr className=\"col-12\"/>\r\n\t\t\t\t\t\t{pdf.pages.map((page,i)=><PdfImage key={i} {...{page,viewport: pdf.viewports[i],className: 'col-4'}}/>)}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</Scrollbar>\r\n\t\t\t}\r\n\t\t\t<div className=\"col-6\">\r\n\t\t\t\t<div>\r\n\t\t\t\t\t<h3 className=\"p-12 pb-0\">{id==='0'?'New':'Edit'} Book</h3>\r\n\t\t\t\t\t<div className=\"p-12 pt-0 h7 text-muted\">Group: {GROUPS[groupId]?.title}</div>\r\n\t\t\t\t\t<hr/>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"row spc-12 f-vert\">\r\n\t\t\t\t\t<div className=\"col\">\r\n\t\t\t\t\t\t<label required className=\"h7 mb-4\">Title</label>\r\n\t\t\t\t\t\t<input required className=\"col-12\" type=\"text\" name=\"title\"/>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div className=\"col\">\r\n\t\t\t\t\t\t<label className=\"h7 mb-4\">Authors</label>\r\n\t\t\t\t\t\t<input className=\"col-12\" type=\"text\" name=\"author_name\"/>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div className=\"col\">\r\n\t\t\t\t\t\t<label className=\"h7 mb-4\">Book ISBN</label>\r\n\t\t\t\t\t\t<input className=\"col-12\" type=\"text\" name=\"isbn\"/>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div className=\"col\">\r\n\t\t\t\t\t\t<label className=\"h7 mb-4\">Description</label>\r\n\t\t\t\t\t\t<textarea className=\"col-12\" name=\"description\"/>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"bottom-row col-12 col-ext row spc-12\">\r\n\t\t\t\t\t<div className=\"col\"/>\r\n\t\t\t\t\t<div className=\"button outline super-center\" onClick={history.goBack}>Cancel</div>\r\n\t\t\t\t\t{pdf?<button>{id==='0'?'Create PageBook':'Save'}</button>:undefined}\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t<Spinner className={local.showSpinner?'active':''}/>\r\n\t\t\t<div className=\"close-btn\" onClick={history.goBack}/>\r\n\t\t</form>\r\n\t</div>\r\n\r\n\tasync function onChange({target}){\r\n\t\tconst {name}=target.files[0]\r\n\t\tref.current.title.value==='' && (ref.current.title.value=name.slice(0,-4))\r\n\t\tconst data=await fileToBase64(target.files[0])\r\n\t\tconst pdfLoadTask=pdfjs.getDocument(data)\r\n\t\tpdfLoadTask.onProgress=({loaded,total})=>console.log(loaded/total*100)\r\n\t\tconst pdf=await pdfLoadTask.promise\r\n\t\tconst promises=new Array(pdf.numPages)\r\n\t\tfor(let i=0;i<promises.length;++i) promises[i]=pdf.getPage(i+1)\r\n\t\tconst pages=await Promise.all(promises)\r\n\t\tconst viewports=pages.map(p=>p.getViewport({scale: .25}))\r\n\t\tviewports[0]=pages[0].getViewport({scale: .75})\r\n\t\tsetPdf({pdf,pages,viewports,name,data})\r\n\t}\r\n\r\n\tasync function onSubmit(e){\r\n\t\te.preventDefault()\r\n\t\ttry{\r\n\t\t\tsetSpinner(true)\r\n\t\t\tconst book={\r\n\t\t\t\t..._.mapValues(_.pick(e.target,[\r\n\t\t\t\t\t'title',\r\n\t\t\t\t\t'author_name',\r\n\t\t\t\t\t'description',\r\n\t\t\t\t\t'isbn',\r\n\t\t\t\t]),i=>i.value),\r\n\t\t\t\tgroup_id: groupId,\r\n\t\t\t\tfile: pdf.data,\r\n\t\t\t\tthumbnail: e.target.querySelector('.uploaded-book img').src,\r\n\t\t\t}\r\n\t\t\tconst {data}=await api('POST','book',book)\r\n\t\t\tdata && dispatch(['SET_DATA',data])\r\n\t\t\thistory.goBack()\r\n\t\t}finally{ setSpinner(false) }\r\n\t}\r\n\r\n\tfunction setSpinner(value){\r\n\t\tlocal.showSpinner=value\r\n\t\tconst spinnerEle=ref.current.querySelector('.spinner')\r\n\t\tvalue?\r\n\t\t\tspinnerEle.classList.add('active'):\r\n\t\t\tspinnerEle.classList.remove('active')\r\n\t}\r\n}))","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAABLAAAAGQCAYAAAC+tZleAAAEuGlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iWE1QIENvcmUgNS41LjAiPgogPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgeG1sbnM6ZXhpZj0iaHR0cDovL25zLmFkb2JlLmNvbS9leGlmLzEuMC8iCiAgICB4bWxuczp0aWZmPSJodHRwOi8vbnMuYWRvYmUuY29tL3RpZmYvMS4wLyIKICAgIHhtbG5zOnBob3Rvc2hvcD0iaHR0cDovL25zLmFkb2JlLmNvbS9waG90b3Nob3AvMS4wLyIKICAgIHhtbG5zOnhtcD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLyIKICAgIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIgogICAgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIKICAgZXhpZjpQaXhlbFhEaW1lbnNpb249IjEyMDAiCiAgIGV4aWY6UGl4ZWxZRGltZW5zaW9uPSI0MDAiCiAgIGV4aWY6Q29sb3JTcGFjZT0iMSIKICAgdGlmZjpJbWFnZVdpZHRoPSIxMjAwIgogICB0aWZmOkltYWdlTGVuZ3RoPSI0MDAiCiAgIHRpZmY6UmVzb2x1dGlvblVuaXQ9IjIiCiAgIHRpZmY6WFJlc29sdXRpb249IjcyLjAiCiAgIHRpZmY6WVJlc29sdXRpb249IjcyLjAiCiAgIHBob3Rvc2hvcDpDb2xvck1vZGU9IjMiCiAgIHBob3Rvc2hvcDpJQ0NQcm9maWxlPSJzUkdCIElFQzYxOTY2LTIuMSIKICAgeG1wOk1vZGlmeURhdGU9IjIwMjEtMDItMDRUMDY6NDI6MzgtMDg6MDAiCiAgIHhtcDpNZXRhZGF0YURhdGU9IjIwMjEtMDItMDRUMDY6NDI6MzgtMDg6MDAiPgogICA8eG1wTU06SGlzdG9yeT4KICAgIDxyZGY6U2VxPgogICAgIDxyZGY6bGkKICAgICAgc3RFdnQ6YWN0aW9uPSJwcm9kdWNlZCIKICAgICAgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWZmaW5pdHkgRGVzaWduZXIgMS44LjUiCiAgICAgIHN0RXZ0OndoZW49IjIwMjEtMDItMDRUMDY6NDI6MzgtMDg6MDAiLz4KICAgIDwvcmRmOlNlcT4KICAgPC94bXBNTTpIaXN0b3J5PgogIDwvcmRmOkRlc2NyaXB0aW9uPgogPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KPD94cGFja2V0IGVuZD0iciI/PiSHzzAAAAGBaUNDUHNSR0IgSUVDNjE5NjYtMi4xAAAokXWRzytEURTHPzNGxIhioVhMGlZDfpTYWMzkV2Ex85Rfm5lnfqh54/XemzTZKtspSmz8WvAXsFXWShEp2SlrYoOe8zw1krm3e8/nfu85p3PPBa+SVTXT1w1azjKio+HAzOxcoOoRLz6ZfbTEVVOfjI0olB1vN3gce9Xp5Crv9++oXUyaKniqhYdU3bCEx4QnVizd4U3hJjUTXxQ+Fg4ZUqDwtaMnXH5yOO3yh8OGEo2At0E4kP7FiV+sZgxNWF5OUMvm1Z96nJf4k7npmNg2Wa2YRBklTIBxhonQTw+DsvfTSS9dcqJMfPd3/BTLEqvKrlPAYIk0GSxCouYle1JsSvSkzCwFp/9/+2qm+nrd7P4wVD7Y9ks7VG3AZ9G23/dt+/MAKu7hLFeKX96DgVfRiyUtuAv1a3ByXtISW3C6Ds13etyIf0sVsrypFDwfQd0sNF5Czbzbs597Dm9BWZWvuoDtHegQ//qFL1MWZ91V/LEXAAAACXBIWXMAAAsTAAALEwEAmpwYAAAHXElEQVR4nO3BMQEAAADCoPVPbQsvoAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAICXAU9DAAHmV7+4AAAAAElFTkSuQmCC\"","import {withContext} from '../../utils/hocs'\r\nimport React,{memo,useState} from 'react'\r\nimport _ from 'lodash'\r\nimport tabStart from '../../assets/imgs/tab-start.svg'\r\nimport {Scrollbar} from 'react-scrollbars-custom'\r\nimport SegmentControls from '../../utils/components/SegmentControls/SegmentControls'\r\nimport {BookContext,PageWiseComments} from '../PageBook/PageBook'\r\n\r\nconst PdfPublicRightSidebar=withContext(BookContext,[\r\n\t'setSidebarMode',\r\n\t'categorized',\r\n\t'pageWiseComments',\r\n\t'pdf',\r\n\t'BookContextLocal',\r\n],memo(function PdfPublicRightSidebar({\r\n\tsidebarMode,\r\n\r\n\tsetSidebarMode,\r\n\tcategorized,\r\n\tpageWiseComments,\r\n\tpdf,\r\n\tBookContextLocal,\r\n}){\r\n\tconst [myComments,setMyComments]=useState(false) // All comments / My Comments\r\n\t// const [publicSearchString,setPublicSearchString]=useState('')\r\n\r\n\tlet pageWiseCommentsTotal=0\r\n\tconst filtered=_.mapValues(pageWiseComments,p=>p.filter(comment=>{\r\n\t\tconst isValidResult=(\r\n\t\t\t(comment.comment_type===sidebarMode) // eslint-disable-line no-mixed-operators\r\n\t\t\t// && (comment.hashtags.indexOf(publicSearchString)!==-1) // TODO: Lowercase\r\n\t\t)\r\n\t\tisValidResult && ++pageWiseCommentsTotal\r\n\t\treturn isValidResult\r\n\t}))\r\n\r\n\tlet temp=pageWiseCommentsTotal\r\n\tlet prevI=0\r\n\tBookContextLocal.pageWiseCommentsBefore=[]\r\n\tBookContextLocal.pageWiseCommentsAfter=[]\r\n\treturn <div className={`RightSidebar row pos-rel p-12 pl-0 mode-${sidebarMode}`}>\r\n\t\t<div className=\"vertical-tabs f-vert\">\r\n\t\t\t<div className=\"col\" style={{maxHeight: '14px'}}/>\r\n\t\t\t\t<div className={sidebarMode==='question'?'active':''} onClick={()=>setSidebarMode('question')}>\r\n\t\t\t\t\t<img src={tabStart} alt=\"\"/>\r\n\t\t\t\t\t<div className=\"vertical-text px-4\">Questions <span className=\"h7\">\r\n\t\t\t\t\t\t{categorized['question'].length}\r\n\t\t\t\t\t</span></div>\r\n\t\t\t\t\t<img src={tabStart} alt=\"\"/>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className={sidebarMode==='comment'?'active':''} onClick={()=>setSidebarMode('comment')}>\r\n\t\t\t\t\t<img src={tabStart} alt=\"\"/>\r\n\t\t\t\t\t<div className=\"vertical-text px-4\">Comments <span className=\"h7\">\r\n\t\t\t\t\t\t{categorized['comment'].length}\r\n\t\t\t\t\t</span></div>\r\n\t\t\t\t\t<img src={tabStart} alt=\"\"/>\r\n\t\t\t\t</div>\r\n\t\t\t<span className=\"col\"/>\r\n\t\t</div>\r\n\t\t<div className=\"col trim\">\r\n\t\t\t<Scrollbar disableTracksWidthCompensation>\r\n\t\t\t\t<div className=\"py-6 f-vert\">\r\n\t\t\t\t\t{_.map(filtered,(p,i)=>{\r\n\t\t\t\t\t\t// TODO: Fix\r\n\t\t\t\t\t\tconst temp2=pageWiseCommentsTotal-temp\r\n\t\t\t\t\t\tfor(let j=prevI;j<i;++j){\r\n\t\t\t\t\t\t\tBookContextLocal.pageWiseCommentsBefore[j]=temp2\r\n\t\t\t\t\t\t\tBookContextLocal.pageWiseCommentsAfter[j]=temp\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tprevI=i\r\n\t\t\t\t\t\tif(p.length){\r\n\t\t\t\t\t\t\tBookContextLocal.pageWiseCommentsBefore[i]=temp2\r\n\t\t\t\t\t\t\ttemp-=p.length\r\n\t\t\t\t\t\t\tBookContextLocal.pageWiseCommentsAfter[i]=temp\r\n\t\t\t\t\t\t\treturn <PageWiseComments {...{p,i}} key={i}/>\r\n\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\tBookContextLocal.pageWiseCommentsBefore[i]=temp2\r\n\t\t\t\t\t\t\tBookContextLocal.pageWiseCommentsAfter[i]=temp\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})}\r\n\t\t\t\t\t{(()=>{\r\n\t\t\t\t\t\tconst temp2=pageWiseCommentsTotal-temp\r\n\t\t\t\t\t\tfor(let j=prevI;j<pdf?.pages.length;++j){\r\n\t\t\t\t\t\t\tBookContextLocal.pageWiseCommentsBefore[j]=temp2\r\n\t\t\t\t\t\t\tBookContextLocal.pageWiseCommentsAfter[j]=temp\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})()}\r\n\t\t\t\t\t<hr className=\"mx-12\"/>\r\n\t\t\t\t\t<div style={{height: '28px'}}/>\r\n\t\t\t\t\t<div className=\"pos-sty top-controls f-order-m1 f-vert mt-m6\">\r\n\t\t\t\t\t\t<div className=\"row spc-12 f-vert\">\r\n\t\t\t\t\t\t\t<SegmentControls value={+myComments}>\r\n\t\t\t\t\t\t\t\t<div className=\"super-center capitalize\" onClick={()=>setMyComments(false)}>All {sidebarMode}s</div>\r\n\t\t\t\t\t\t\t\t<div className=\"super-center capitalize\" onClick={()=>setMyComments(true)}>My {sidebarMode}s</div>\r\n\t\t\t\t\t\t\t</SegmentControls>\r\n\t\t\t\t\t\t\t<input type=\"text\" placeholder=\" &#xf002;  Filter\"/> {/* TODO: Fix */}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div className=\"mx-auto pill my-8 px-10 py-2 h7\">{` ${sidebarMode}`}s above<i className=\"icon-chevron_up icon px-4\"/></div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</Scrollbar>\r\n\t\t\t<div className=\"mx-auto pill my-8 px-10 py-2 h7 bottom\">{` ${sidebarMode}`}s below<i className=\"icon-chevron_down icon px-4\"/></div>\r\n\t\t</div>\r\n\t</div>\r\n}))\r\n\r\nexport default PdfPublicRightSidebar","module.exports = __webpack_public_path__ + \"static/media/spinner.3d035a55.gif\";","import React,{useEffect,useRef,memo} from 'react'\r\nimport {Scrollbar} from 'react-scrollbars-custom'\r\n\r\nimport './PdfVerticalScroll.scss'\r\nimport {getChildNodeIndex,getSelectionOffsetFromParent,binarySearchFindClosestIndex} from '../../utils/helper'\r\nimport {BookContext,NewCommentBubble,Page} from '../PageBook/PageBook'\r\nimport {useLocal} from '../../utils/hooks'\r\nimport {withContext} from '../../utils/hocs'\r\n\r\n// TODO: Extra - PDF download progressbar\r\n// TODO: Extra - Password protected PDFs\r\n\r\nconst logLifecycle=false\r\n\r\nexport default withContext(BookContext,[\r\n\t'pdf',\r\n\t'pageWiseComments',\r\n\t'setVisiblePages',\r\n\t'setSelection',\r\n\t'setBubblePos',\r\n],memo(function PdfVerticalScroll({\r\n\tpdf,\r\n\tpageWiseComments,\r\n\tsetVisiblePages,\r\n\tsetSelection,\r\n\tsetBubblePos,\r\n}){\r\n\tconst local=useLocal({\r\n\t\tpageTops: [],\r\n\t\tpageBottoms: [],\r\n\t\tloaders: [],\r\n\r\n\t\tprevTopLoadedPage: undefined,\r\n\t\tprevBottomLoadedPage: undefined,\r\n\t\tprevTopPage: undefined,\r\n\t\tprevBottomPage: undefined,\r\n\t})\r\n\tconst ref=useRef()\r\n\r\n\tuseEffect(function pdfInitDivs(){\r\n\t\tlogLifecycle && console.log('PdfVerticalScroll pdfInitDivs')\r\n\r\n\t\tconst pageEles=ref.current.children\r\n\t\tlocal.pageTops=[]\r\n\t\tlocal.pageBottoms=[]\r\n\t\tfor(let i=0;i<pageEles.length;++i){\r\n\t\t\tconst {offsetTop,offsetHeight}=pageEles[i]\r\n\t\t\tlocal.pageTops[i]=offsetTop\r\n\t\t\tlocal.pageBottoms[i]=offsetTop+offsetHeight\r\n\t\t}\r\n\t\tref.current.closest('.ScrollbarsCustom-Scroller').scrollTo(0,1)\r\n\t},[pdf]) // eslint-disable-line react-hooks/exhaustive-deps\r\n\r\n\treturn <Scrollbar disableTracksWidthCompensation className=\"PdfVerticalScroll\" {...{onScroll}}>\r\n\t\t<div className=\"row f-center f-vert p-6\" {...{onClick,ref}}>\r\n\t\t\t{pdf?.pages?.map((page,i)=>{\r\n\t\t\t\tconst viewport=pdf.viewports[i]\r\n\t\t\t\treturn <div className=\"p-6\" key={i}>\r\n\t\t\t\t\t<Page {...{page,viewport,i,pageComments: pageWiseComments[i],loaders: local.loaders}}/>\r\n\t\t\t\t</div>\r\n\t\t\t})}\r\n\t\t</div>\r\n\t\t<NewCommentBubble/>\r\n\t</Scrollbar>\r\n\r\n\t// TODO: Check on window resize\r\n\tfunction onScroll(e){\r\n\t\tconst lastPageNum=local.pageBottoms.length-1 // TODO: This needs to be updated on pdfLoad\r\n\r\n\t\t// One viewport look ahead\r\n\t\tconst topLoadOffset=e.scrollTop-e.clientHeight\r\n\t\tconst bottomLoadOffset=e.scrollTop+(e.clientHeight<<1)\r\n\r\n\t\tlet topLoadedPage=binarySearchFindClosestIndex(local.pageTops,topLoadOffset)\r\n\t\tif(topLoadOffset<local.pageTops[topLoadedPage]) topLoadedPage=Math.max(--topLoadedPage,0) // Lowerbound\r\n\t\tlet bottomLoadedPage=binarySearchFindClosestIndex(local.pageBottoms,bottomLoadOffset)\r\n\t\tif(bottomLoadOffset>local.pageBottoms[bottomLoadedPage]) bottomLoadedPage=Math.min(++bottomLoadedPage,lastPageNum) // Upperbound\r\n\t\t// console.log({topLoadedPage,bottomLoadedPage})\r\n\r\n\t\t// First load\r\n\t\tif(local.prevTopLoadedPage===undefined && local.prevBottomLoadedPage===undefined){\r\n\t\t\tfor(let i=topLoadedPage;i<=bottomLoadedPage;++i) local.loaders[i](true)\r\n\t\t\tlocal.prevTopLoadedPage=topLoadedPage\r\n\t\t\tlocal.prevBottomLoadedPage=bottomLoadedPage\r\n\t\t}\r\n\t\tif(local.prevTopLoadedPage!==topLoadedPage){\r\n\t\t\tfor(let i=topLoadedPage-1;i>=local.prevTopLoadedPage;--i) local.loaders[i](false)\r\n\t\t\tfor(let i=topLoadedPage;i<=local.prevTopLoadedPage;++i) local.loaders[i](true)\r\n\t\t\t// console.log({topLoadedPage})\r\n\t\t\tlocal.prevTopLoadedPage=topLoadedPage\r\n\t\t}\r\n\t\tif(local.prevBottomLoadedPage!==bottomLoadedPage){\r\n\t\t\tfor(let i=bottomLoadedPage+1;i<=local.prevBottomLoadedPage;++i) local.loaders[i](false)\r\n\t\t\tfor(let i=bottomLoadedPage;i>=local.prevBottomLoadedPage;--i) local.loaders[i](true)\r\n\t\t\t// console.log({bottomLoadedPage})\r\n\t\t\tlocal.prevBottomLoadedPage=bottomLoadedPage\r\n\t\t}\r\n\r\n\t\tconst topOffset=e.scrollTop\r\n\t\tconst bottomOffset=e.scrollTop+e.clientHeight\r\n\r\n\t\tlet topPage=binarySearchFindClosestIndex(local.pageTops,topOffset)\r\n\t\tif(topOffset<local.pageTops[topPage]) topPage=Math.max(--topPage,0) // Lowerbound\r\n\t\tlet bottomPage=binarySearchFindClosestIndex(local.pageBottoms,bottomOffset)\r\n\t\tif(bottomOffset>local.pageBottoms[bottomPage]) bottomPage=Math.min(++bottomPage,lastPageNum) // Upperbound\r\n\r\n\t\tif(local.prevTopPage!==topPage || local.prevBottomPage!==bottomPage){\r\n\t\t\tsetVisiblePages(topPage,bottomPage)\r\n\t\t\tlocal.prevTopPage=topPage\r\n\t\t\tlocal.prevBottomPage=bottomPage\r\n\t\t}\r\n\t}\r\n\r\n\tfunction onClick(){\r\n\t\ttry{\r\n\t\t\tconst s=window.getSelection()\r\n\t\t\tif(s.toString()==='') throw new Error('No text selected')\r\n\t\t\tlet {anchorNode,focusNode}=s\r\n\t\t\twhile(!anchorNode.closest) anchorNode=anchorNode.parentNode\r\n\t\t\twhile(!focusNode.closest) focusNode=focusNode.parentNode\r\n\r\n\t\t\tconst anchorNodeSpan=anchorNode.closest('span')\r\n\t\t\tconst focusNodeSpan=focusNode.closest('span')\r\n\t\t\tlet selection={\r\n\t\t\t\tstartPage:   +anchorNode.closest('.Page').dataset.pageIndex,\r\n\t\t\t\tstartLine:   getChildNodeIndex(anchorNodeSpan),\r\n\t\t\t\tstartOffset: getSelectionOffsetFromParent(anchorNode,anchorNodeSpan,s.anchorOffset),\r\n\t\t\t\tendPage:     +focusNode.closest('.Page').dataset.pageIndex,\r\n\t\t\t\tendLine:     getChildNodeIndex(focusNodeSpan),\r\n\t\t\t\tendOffset:   getSelectionOffsetFromParent(focusNode,focusNodeSpan,s.focusOffset),\r\n\t\t\t}\r\n\r\n\t\t\t// if selection is in reverse order, swap selection start and end\r\n\t\t\tif(\r\n\t\t\t\tselection.endPage<selection.startPage ||       // eslint-disable-line no-mixed-operators\r\n\t\t\t\tselection.endPage===selection.startPage && (   // eslint-disable-line no-mixed-operators\r\n\t\t\t\t\tselection.endLine<selection.startLine ||     // eslint-disable-line no-mixed-operators\r\n\t\t\t\t\tselection.endLine===selection.startLine && ( // eslint-disable-line no-mixed-operators\r\n\t\t\t\t\t\tselection.endOffset<selection.startOffset  // eslint-disable-line no-mixed-operators\r\n\t\t\t\t\t)\r\n\t\t\t\t)\r\n\t\t\t){\r\n\t\t\t\tselection={\r\n\t\t\t\t\tstartPage:   selection.endPage,\r\n\t\t\t\t\tstartLine:   selection.endLine,\r\n\t\t\t\t\tstartOffset: selection.endOffset,\r\n\t\t\t\t\tendPage:     selection.startPage,\r\n\t\t\t\t\tendLine:     selection.startLine,\r\n\t\t\t\t\tendOffset:   selection.startOffset,\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tconst pagesDOM=Array.from(ref.current.children).slice(\r\n\t\t\t\tselection.startPage,\r\n\t\t\t\tselection.endPage+1,\r\n\t\t\t)\r\n\t\t\tif(pagesDOM.length===1){\r\n\t\t\t\tselection=[{\r\n\t\t\t\t\tpage:        selection.startPage,\r\n\t\t\t\t\tstartLine:   selection.startLine,\r\n\t\t\t\t\tstartOffset: selection.startOffset,\r\n\t\t\t\t\tendLine:     selection.endLine,\r\n\t\t\t\t\tendOffset:   selection.endOffset,\r\n\t\t\t\t}]\r\n\t\t\t}else{\r\n\t\t\t\tthrow new Error('Multi-page selection disabled')\r\n\r\n\t\t\t\t// eslint-disable-next-line no-unreachable\r\n\t\t\t\tconst startPage=pagesDOM.shift()\r\n\t\t\t\tconst startPageLines=startPage.children[1].children\r\n\t\t\t\tconst startPageLastLine=Array.from(startPageLines).pop()\r\n\t\t\t\t/*const lastPage=*/pagesDOM.pop()\r\n\t\t\t\tselection=[\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tpage:        selection.startPage,\r\n\t\t\t\t\t\tstartLine:   selection.startLine,\r\n\t\t\t\t\t\tstartOffset: selection.startOffset,\r\n\t\t\t\t\t\tendLine:     startPageLines.length-1,\r\n\t\t\t\t\t\tendOffset:   startPageLastLine.innerText.length,\r\n\t\t\t\t\t},\r\n\t\t\t\t\t...pagesDOM.map((page,i)=>{\r\n\t\t\t\t\t\tconst pageLines=page.children[1].children\r\n\t\t\t\t\t\tconst pageLastLine=Array.from(pageLines).pop()\r\n\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\tpage: selection.startPage+i+1,\r\n\t\t\t\t\t\t\tstartLine:   0,\r\n\t\t\t\t\t\t\tstartOffset: 0,\r\n\t\t\t\t\t\t\tendLine:     pageLines.length-1,\r\n\t\t\t\t\t\t\tendOffset:   pageLastLine.innerText.length,\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}),\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tpage:        selection.endPage,\r\n\t\t\t\t\t\tstartLine:   0,\r\n\t\t\t\t\t\tstartOffset: 0,\r\n\t\t\t\t\t\tendLine:     selection.endLine,\r\n\t\t\t\t\t\tendOffset:   selection.endOffset,\r\n\t\t\t\t\t},\r\n\t\t\t\t]\r\n\t\t\t}\r\n\r\n\t\t\tconst focusNodeClientRect=focusNode.getBoundingClientRect()\r\n\t\t\tconst scrollNode=focusNode.closest('.ScrollbarsCustom-Scroller')\r\n\r\n\t\t\tconsole.log(selection)\r\n\t\t\tsetSelection({\r\n\t\t\t\ttype: 'text',\r\n\t\t\t\ttext: s.toString(),\r\n\t\t\t\tdata: selection,\r\n\t\t\t})\r\n\t\t\tsetBubblePos({\r\n\t\t\t\ttop: focusNodeClientRect.top+focusNodeClientRect.height+scrollNode.scrollTop,\r\n\t\t\t\t// left: focusNodeClientRect.left+focusNodeClientRect.width\r\n\t\t\t})\r\n\t\t}catch(e){\r\n\t\t\tconsole.log(e)\r\n\t\t\t// TODO: reset selection\r\n\t\t\tsetSelection(undefined)\r\n\t\t\tsetBubblePos({})\r\n\t\t}\r\n\t}\r\n}))","import {withContext} from '../../utils/hocs'\r\nimport React,{memo} from 'react'\r\nimport _ from 'lodash'\r\nimport tabStart from '../../assets/imgs/tab-start.svg'\r\nimport {Scrollbar} from 'react-scrollbars-custom'\r\nimport {Link} from 'react-router-dom'\r\nimport {BookContext,PageWiseComments} from '../PageBook/PageBook'\r\nimport Comment from '../Comment/Comment'\r\nimport {history} from '../../contexts/MainContext'\r\n\r\nconst PdfNotesRightSidebar=withContext(BookContext,[\r\n\t'setSidebarMode',\r\n\t'categorized',\r\n\t'pageWiseComments',\r\n\t'userId',\r\n\t'pdf',\r\n\t'BookContextLocal',\r\n],memo(function PdfNotesRightSidebar({\r\n\tsetSidebarMode,\r\n\tcategorized,\r\n\tpageWiseComments,\r\n\tuserId,\r\n\tpdf,\r\n\tBookContextLocal,\r\n}){\r\n\tlet pageWiseCommentsTotal=0\r\n\tconst filtered=_.mapValues(pageWiseComments,p=>p.filter(comment=>{\r\n\t\tconst isValidResult=(\r\n\t\t\t// TODO: Backend send only user notes and remove below comment.user_id===userId\r\n\t\t\t(comment.comment_type==='note') // eslint-disable-line no-mixed-operators\r\n\t\t\t&& (comment.user_id===userId)   // eslint-disable-line no-mixed-operators\r\n\t\t\t// && (comment.hashtags.indexOf(publicSearchString)!==-1) // TODO: Lowercase\r\n\t\t)\r\n\t\tisValidResult && ++pageWiseCommentsTotal\r\n\t\treturn isValidResult\r\n\t}))\r\n\r\n\tlet temp=pageWiseCommentsTotal\r\n\tlet prevI=0\r\n\tBookContextLocal.pageWiseCommentsBefore=[]\r\n\tBookContextLocal.pageWiseCommentsAfter=[]\r\n\treturn <div className={`RightSidebar row pos-rel p-12 pl-0 mode-note`}>\r\n\t\t<div className=\"vertical-tabs f-vert\">\r\n\t\t\t<div className=\"col\" style={{maxHeight: '14px'}}/>\r\n\t\t\t\t<div className=\"active\" onClick={()=>setSidebarMode('note')}>\r\n\t\t\t\t\t<img src={tabStart} alt=\"\"/>\r\n\t\t\t\t\t<div className=\"vertical-text px-4\">Notes <span className=\"h7\">\r\n\t\t\t\t\t\t{categorized['note'].length}\r\n\t\t\t\t\t</span></div>\r\n\t\t\t\t\t<img src={tabStart} alt=\"\"/>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div onClick={()=>setSidebarMode('highlight')}>\r\n\t\t\t\t\t<img src={tabStart} alt=\"\"/>\r\n\t\t\t\t\t<div className=\"vertical-text px-4\">Highlights <span className=\"h7\">\r\n\t\t\t\t\t\t{categorized['highlight'].length}\r\n\t\t\t\t\t</span></div>\r\n\t\t\t\t\t<img src={tabStart} alt=\"\"/>\r\n\t\t\t\t</div>\r\n\t\t\t<span className=\"col\"/>\r\n\t\t</div>\r\n\t\t<div className=\"col trim\">\r\n\t\t\t<Scrollbar disableTracksWidthCompensation>\r\n\t\t\t\t<div className=\"py-6 row spc-12\">\r\n\t\t\t\t\t{/*{_.map(filtered,(p,i)=>{*/}\r\n\t\t\t\t\t{/*\t// TODO: Fix*/}\r\n\t\t\t\t\t{/*\tconst temp2=pageWiseCommentsTotal-temp*/}\r\n\t\t\t\t\t{/*\tfor(let j=prevI;j<i;++j){*/}\r\n\t\t\t\t\t{/*\t\tBookContextLocal.pageWiseCommentsBefore[j]=temp2*/}\r\n\t\t\t\t\t{/*\t\tBookContextLocal.pageWiseCommentsAfter[j]=temp*/}\r\n\t\t\t\t\t{/*\t}*/}\r\n\t\t\t\t\t{/*\tprevI=i*/}\r\n\t\t\t\t\t{/*\tif(p.length){*/}\r\n\t\t\t\t\t{/*\t\tBookContextLocal.pageWiseCommentsBefore[i]=temp2*/}\r\n\t\t\t\t\t{/*\t\ttemp-=p.length*/}\r\n\t\t\t\t\t{/*\t\tBookContextLocal.pageWiseCommentsAfter[i]=temp*/}\r\n\t\t\t\t\t{/*\t\treturn <PageWiseComments {...{p,i}} key={i}/>*/}\r\n\t\t\t\t\t{/*\t}else{*/}\r\n\t\t\t\t\t{/*\t\tBookContextLocal.pageWiseCommentsBefore[i]=temp2*/}\r\n\t\t\t\t\t{/*\t\tBookContextLocal.pageWiseCommentsAfter[i]=temp*/}\r\n\t\t\t\t\t{/*\t}*/}\r\n\t\t\t\t\t{/*})}*/}\r\n\t\t\t\t\t{/*{(()=>{*/}\r\n\t\t\t\t\t{/*\tconst temp2=pageWiseCommentsTotal-temp*/}\r\n\t\t\t\t\t{/*\tfor(let j=prevI;j<pdf?.pages.length;++j){*/}\r\n\t\t\t\t\t{/*\t\tBookContextLocal.pageWiseCommentsBefore[j]=temp2*/}\r\n\t\t\t\t\t{/*\t\tBookContextLocal.pageWiseCommentsAfter[j]=temp*/}\r\n\t\t\t\t\t{/*\t}*/}\r\n\t\t\t\t\t{/*})()}*/}\r\n\t\t\t\t\t{categorized['note'].map(note=><div className=\"col-6\"><Comment key={note.id} commentId={note.id}/></div>)}\r\n\t\t\t\t\t<div className=\"col-12\" style={{height: '72px'}}/>\r\n\t\t\t\t\t<div className=\"col-12 pos-sty top-controls f-order-m1 f-vert col-ext-x col-ext-t\">\r\n\t\t\t\t\t\t<div className=\"row spc-12 f-vert\">\r\n\t\t\t\t\t\t\t<input type=\"text\" placeholder=\" &#xf002;  Filter\"/> {/* TODO: Fix */}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t{/*<div className=\"mx-auto pill my-8 px-10 py-2 h7\"> Notes above<i className=\"icon-chevron_up icon px-4\"/></div>*/}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</Scrollbar>\r\n\t\t\t{/*<div className=\"mx-auto pill my-8 px-10 py-2 h7 bottom\"> Notes below<i className=\"icon-chevron_down icon px-4\"/></div>*/}\r\n\t\t\t<Link to={history.location.pathname+'/new-comment'} className=\"add-note fa fa-plus button pos-abs super-center\"/>\r\n\t\t</div>\r\n\t</div>\r\n}))\r\n\r\nexport default PdfNotesRightSidebar","import {withContext} from '../../utils/hocs'\r\nimport React,{memo} from 'react'\r\nimport _ from 'lodash'\r\nimport tabStart from '../../assets/imgs/tab-start.svg'\r\nimport {Scrollbar} from 'react-scrollbars-custom'\r\nimport {BookContext,PageWiseComments} from '../PageBook/PageBook'\r\n\r\nconst PdfHighlightRightSidebar=withContext(BookContext,[\r\n\t'setSidebarMode',\r\n\t'categorized',\r\n\t'pageWiseComments',\r\n\t'userId',\r\n\t'pdf',\r\n\t'BookContextLocal',\r\n],memo(function({\r\n\tsetSidebarMode,\r\n\tcategorized,\r\n\tpageWiseComments,\r\n\tuserId,\r\n\tpdf,\r\n\tBookContextLocal,\r\n}){\r\n\tlet pageWiseCommentsTotal=0\r\n\tconst filtered=_.mapValues(pageWiseComments,p=>p.filter(comment=>{\r\n\t\tconst isValidResult=(\r\n\t\t\t// TODO: Backend send only user notes and remove below comment.user_id===userId\r\n\t\t\t(comment.comment_type==='highlight') // eslint-disable-line no-mixed-operators\r\n\t\t\t&& (comment.user_id===userId)   // eslint-disable-line no-mixed-operators\r\n\t\t)\r\n\t\tisValidResult && ++pageWiseCommentsTotal\r\n\t\treturn isValidResult\r\n\t}))\r\n\r\n\tlet temp=pageWiseCommentsTotal\r\n\tlet prevI=0\r\n\tBookContextLocal.pageWiseCommentsBefore=[]\r\n\tBookContextLocal.pageWiseCommentsAfter=[]\r\n\treturn <div className={`RightSidebar row pos-rel p-12 pl-0 mode-highlight`}>\r\n\t\t<div className=\"vertical-tabs f-vert\">\r\n\t\t\t<div className=\"col\" style={{maxHeight: '14px'}}/>\r\n\t\t\t<div onClick={()=>setSidebarMode('note')}>\r\n\t\t\t\t<img src={tabStart} alt=\"\"/>\r\n\t\t\t\t<div className=\"vertical-text px-4\">Notes <span className=\"h7\">\r\n\t\t\t\t\t\t{categorized['note'].length}\r\n\t\t\t\t\t</span></div>\r\n\t\t\t\t<img src={tabStart} alt=\"\"/>\r\n\t\t\t</div>\r\n\t\t\t<div className=\"active\" onClick={()=>setSidebarMode('highlight')}>\r\n\t\t\t\t<img src={tabStart} alt=\"\"/>\r\n\t\t\t\t<div className=\"vertical-text px-4\">Highlights <span className=\"h7\">\r\n\t\t\t\t\t\t{categorized['highlight'].length}\r\n\t\t\t\t\t</span></div>\r\n\t\t\t\t<img src={tabStart} alt=\"\"/>\r\n\t\t\t</div>\r\n\t\t\t<span className=\"col\"/>\r\n\t\t</div>\r\n\t\t<div className=\"col trim\">\r\n\t\t\t<Scrollbar disableTracksWidthCompensation>\r\n\t\t\t\t<div className=\"py-6 f-vert\">\r\n\t\t\t\t\t{_.map(filtered,(p,i)=>{\r\n\t\t\t\t\t\t// TODO: Fix\r\n\t\t\t\t\t\tconst temp2=pageWiseCommentsTotal-temp\r\n\t\t\t\t\t\tfor(let j=prevI;j<i;++j){\r\n\t\t\t\t\t\t\tBookContextLocal.pageWiseCommentsBefore[j]=temp2\r\n\t\t\t\t\t\t\tBookContextLocal.pageWiseCommentsAfter[j]=temp\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tprevI=i\r\n\t\t\t\t\t\tif(p.length){\r\n\t\t\t\t\t\t\tBookContextLocal.pageWiseCommentsBefore[i]=temp2\r\n\t\t\t\t\t\t\ttemp-=p.length\r\n\t\t\t\t\t\t\tBookContextLocal.pageWiseCommentsAfter[i]=temp\r\n\t\t\t\t\t\t\treturn <PageWiseComments {...{p,i}} key={i}/>\r\n\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\tBookContextLocal.pageWiseCommentsBefore[i]=temp2\r\n\t\t\t\t\t\t\tBookContextLocal.pageWiseCommentsAfter[i]=temp\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})}\r\n\t\t\t\t\t{(()=>{\r\n\t\t\t\t\t\tconst temp2=pageWiseCommentsTotal-temp\r\n\t\t\t\t\t\tfor(let j=prevI;j<pdf?.pages.length;++j){\r\n\t\t\t\t\t\t\tBookContextLocal.pageWiseCommentsBefore[j]=temp2\r\n\t\t\t\t\t\t\tBookContextLocal.pageWiseCommentsAfter[j]=temp\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})()}\r\n\t\t\t\t\t<hr className=\"mx-12\"/>\r\n\t\t\t\t\t<div style={{height: '28px'}}/>\r\n\t\t\t\t\t<div className=\"pos-sty top-controls f-order-m1 f-vert mt-m6\">\r\n\t\t\t\t\t\t<div className=\"mx-auto pill my-8 px-10 py-2 h7\">{` highlight`}s above<i className=\"icon-chevron_up icon px-4\"/></div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</Scrollbar>\r\n\t\t\t<div className=\"mx-auto pill my-8 px-10 py-2 h7 bottom\">{` highlight`}s below<i className=\"icon-chevron_down icon px-4\"/></div>\r\n\t\t</div>\r\n\t</div>\r\n}))\r\n\r\nexport default PdfHighlightRightSidebar","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' },\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import React from 'react'\nimport ReactDOM from 'react-dom'\nimport {HashRouter} from 'react-router-dom'\n\nimport './index.scss'\nimport App from './components/App/App'\nimport * as serviceWorker from './serviceWorker'\nimport MainContextProvider from './contexts/MainContext'\n\nReactDOM.render(\n\t<HashRouter>\n\t\t<MainContextProvider>\n\t\t\t{/*<React.StrictMode>*/}\n\t\t\t\t<App/>\n\t\t\t{/*</React.StrictMode>*/}\n\t\t</MainContextProvider>\n\t</HashRouter>,\n\tdocument.getElementById('root')\n)\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.register()\n"],"sourceRoot":""}